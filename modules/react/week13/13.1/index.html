<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>13.1 API Handling, Server Actions and Middleware | MAD9022</title>
    <meta name="generator" content="VuePress 1.9.8">
    
    <meta name="description" content="Fullstack: Frontend Development Course">
    
    <link rel="preload" href="/s2024/assets/css/0.styles.0189e570.css" as="style"><link rel="preload" href="/s2024/assets/js/app.800de6cb.js" as="script"><link rel="preload" href="/s2024/assets/js/2.65264708.js" as="script"><link rel="preload" href="/s2024/assets/js/45.8da8f59f.js" as="script"><link rel="preload" href="/s2024/assets/js/9.005e1e8c.js" as="script"><link rel="preload" href="/s2024/assets/js/11.87711128.js" as="script"><link rel="prefetch" href="/s2024/assets/js/10.912d3f44.js"><link rel="prefetch" href="/s2024/assets/js/12.1ad3b3b9.js"><link rel="prefetch" href="/s2024/assets/js/13.5c6eca3c.js"><link rel="prefetch" href="/s2024/assets/js/14.a39ca56d.js"><link rel="prefetch" href="/s2024/assets/js/15.fea1e72e.js"><link rel="prefetch" href="/s2024/assets/js/16.6b8223ef.js"><link rel="prefetch" href="/s2024/assets/js/17.db7cf2f4.js"><link rel="prefetch" href="/s2024/assets/js/18.7759db48.js"><link rel="prefetch" href="/s2024/assets/js/19.bb0f2052.js"><link rel="prefetch" href="/s2024/assets/js/20.3f3d5c16.js"><link rel="prefetch" href="/s2024/assets/js/21.23f944a3.js"><link rel="prefetch" href="/s2024/assets/js/22.32b2777d.js"><link rel="prefetch" href="/s2024/assets/js/23.aa560bd2.js"><link rel="prefetch" href="/s2024/assets/js/24.1160513f.js"><link rel="prefetch" href="/s2024/assets/js/25.257a77d2.js"><link rel="prefetch" href="/s2024/assets/js/26.9c34cefb.js"><link rel="prefetch" href="/s2024/assets/js/27.b2ff0a06.js"><link rel="prefetch" href="/s2024/assets/js/28.d09f9311.js"><link rel="prefetch" href="/s2024/assets/js/29.a0941762.js"><link rel="prefetch" href="/s2024/assets/js/3.544714c7.js"><link rel="prefetch" href="/s2024/assets/js/30.47ebd370.js"><link rel="prefetch" href="/s2024/assets/js/31.ece81fbc.js"><link rel="prefetch" href="/s2024/assets/js/32.ae206ed9.js"><link rel="prefetch" href="/s2024/assets/js/33.9514a6a6.js"><link rel="prefetch" href="/s2024/assets/js/34.583d401c.js"><link rel="prefetch" href="/s2024/assets/js/35.e656cbcf.js"><link rel="prefetch" href="/s2024/assets/js/36.cacc60df.js"><link rel="prefetch" href="/s2024/assets/js/37.1d4e63ca.js"><link rel="prefetch" href="/s2024/assets/js/38.4711b180.js"><link rel="prefetch" href="/s2024/assets/js/39.28fe2c35.js"><link rel="prefetch" href="/s2024/assets/js/4.a59aad47.js"><link rel="prefetch" href="/s2024/assets/js/40.7a728e12.js"><link rel="prefetch" href="/s2024/assets/js/41.102054ba.js"><link rel="prefetch" href="/s2024/assets/js/42.e4927ef8.js"><link rel="prefetch" href="/s2024/assets/js/43.991ea947.js"><link rel="prefetch" href="/s2024/assets/js/44.8db11b89.js"><link rel="prefetch" href="/s2024/assets/js/46.e4ae4586.js"><link rel="prefetch" href="/s2024/assets/js/47.3a64f81f.js"><link rel="prefetch" href="/s2024/assets/js/48.85a59034.js"><link rel="prefetch" href="/s2024/assets/js/49.d9dd3379.js"><link rel="prefetch" href="/s2024/assets/js/5.6426ebe4.js"><link rel="prefetch" href="/s2024/assets/js/50.51e2c9f2.js"><link rel="prefetch" href="/s2024/assets/js/51.bcc581ae.js"><link rel="prefetch" href="/s2024/assets/js/52.42daf800.js"><link rel="prefetch" href="/s2024/assets/js/6.2beeeb0e.js"><link rel="prefetch" href="/s2024/assets/js/7.64cbf74e.js"><link rel="prefetch" href="/s2024/assets/js/8.e15ce9b2.js">
    <link rel="stylesheet" href="/s2024/assets/css/0.styles.0189e570.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/s2024/" class="home-link router-link-active"><img src="/s2024/mad-d-logo-sm.png" alt="MAD9022" class="logo"> <span class="site-name can-hide">MAD9022</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/s2024/overview/" class="nav-link">
  Overview
</a></div><div class="nav-item"><a href="/s2024/assignments/" class="nav-link">
  Deliverables
</a></div><div class="nav-item"><a href="/s2024/resources/" class="nav-link">
  Resources
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/s2024/overview/" class="nav-link">
  Overview
</a></div><div class="nav-item"><a href="/s2024/assignments/" class="nav-link">
  Deliverables
</a></div><div class="nav-item"><a href="/s2024/resources/" class="nav-link">
  Resources
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Hybrid</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>PWA</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>React</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/s2024/modules/react/week9/9.1/" class="sidebar-link">9.1: React Concepts</a></li><li><a href="/s2024/modules/react/week9/9.2/" class="sidebar-link">9.2: React Setup</a></li><li><a href="/s2024/modules/react/week10/10.1/" class="sidebar-link">10.1: JSX &amp; Components</a></li><li><a href="/s2024/modules/react/week10/10.2/" class="sidebar-link">10.2: Conditional Rendering, Data, and State</a></li><li><a href="/s2024/modules/react/week11/11.1/" class="sidebar-link">11.1: Synthetic Events and Props</a></li><li><a href="/s2024/modules/react/week11/11.2/" class="sidebar-link">11.2: Refs, Axios, Fetch, and Spinners</a></li><li><a href="/s2024/modules/react/week12/12.1/" class="sidebar-link">12.1: NextJS Intro</a></li><li><a href="/s2024/modules/react/week12/12.2/" class="sidebar-link">12.2: NextJS Routing</a></li><li><a href="/s2024/modules/react/week13/13.1/" aria-current="page" class="active sidebar-link">13.1: NextJS APIs, Actions, &amp; Middleware</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/s2024/modules/react/week13/13.1/#nextjs-api-handling" class="sidebar-link">NextJS API Handling</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/s2024/modules/react/week13/13.1/#props-params-and-searchparams" class="sidebar-link">Props params and searchParams</a></li><li class="sidebar-sub-header"><a href="/s2024/modules/react/week13/13.1/#route-js-files" class="sidebar-link">route.js Files</a></li><li class="sidebar-sub-header"><a href="/s2024/modules/react/week13/13.1/#server-side-redirects" class="sidebar-link">Server-Side Redirects</a></li><li class="sidebar-sub-header"><a href="/s2024/modules/react/week13/13.1/#custom-paths-for-imports" class="sidebar-link">Custom Paths for Imports</a></li></ul></li><li class="sidebar-sub-header"><a href="/s2024/modules/react/week13/13.1/#server-actions" class="sidebar-link">Server Actions</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/s2024/modules/react/week13/13.1/#useformstatus-hook" class="sidebar-link">useFormStatus Hook</a></li></ul></li><li class="sidebar-sub-header"><a href="/s2024/modules/react/week13/13.1/#error-handling" class="sidebar-link">Error Handling</a></li><li class="sidebar-sub-header"><a href="/s2024/modules/react/week13/13.1/#suspense" class="sidebar-link">Suspense</a></li><li class="sidebar-sub-header"><a href="/s2024/modules/react/week13/13.1/#middleware" class="sidebar-link">Middleware</a></li><li class="sidebar-sub-header"><a href="/s2024/modules/react/week13/13.1/#cookies" class="sidebar-link">Cookies</a></li><li class="sidebar-sub-header"><a href="/s2024/modules/react/week13/13.1/#what-to-do-this-week" class="sidebar-link">What to do this week</a></li></ul></li><li><a href="/s2024/modules/react/week13/13.2/" class="sidebar-link">13.2: Styling and Theming</a></li><li><a href="/s2024/modules/react/week14/14.1/" class="sidebar-link">14.1: TypeScript and Pair Programming</a></li><li><a href="/s2024/modules/react/week14/14.2/" class="sidebar-link">14.2: Authentication</a></li><li><a href="/s2024/modules/react/week15/" class="sidebar-link">15: NextJS Project</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><header><div class="section-title blue">
    React | NextJS
  </div> <h1>13.1 API Handling, Server Actions and Middleware</h1> <div class="underdev no">Module Still Under Development</div></header> <h2 id="nextjs-api-handling"><a href="#nextjs-api-handling" class="header-anchor">#</a> NextJS API Handling</h2> <p>When building React Apps you are basically creating a SPA. With NextJS we get server-side routing for free. We are building pages, not just components inside one page.</p> <p>For each folder you have a <code>page.js</code> file. Combined with the parent <code>layout.js</code> this creates the index.html file for the current route. These pages are used on the server side to create the HTML
<strong>before</strong> it gets sent to the browser.</p> <div class="custom-block tip"><p class="custom-block-title">NextJS - Just Like Express</p> <p>NextJS apps can be thought of like an Express app. Just like in MAD9124, you are building a server-side application with endpoints.</p> <p>In NextJS, the endpoints are either a <code>page.js</code> file or a <code>route.js</code> file.</p> <p>Page.js files return HTML files.</p> <p>Route.js files can return any file type (but typically return JSON).</p></div> <p>You still have reusable components. Inside the <code>app</code> folder you should create a <code>components</code> folder where you can save all the reusable components. These components can be server side ones or you can
add the <code>use client</code> directive on the first line to make them into a component that will be streamed to the browser and rendered with client side JavaScript.</p> <p>Since your pages are server side script, it means that you can make the fetch calls from the server side too.</p> <p>If you consider the APIs that you are building in MAD9124, then you will remember that server side fetch calls do NOT have the <code>CORS</code> restrictions that the browsers have. They also can include API
keys because this script never gets sent to the browser. There is no security risk having your API key in the server side JS. With a client side script, including your API key does expose the key to
anyone who visits your website.</p> <p>With server side fetching, we need no state variables or hooks like <code>useEffect</code> and <code>useState</code>.</p> <blockquote><p>Server-side rendering means avoiding CORS issues.</p></blockquote> <p>Here is a simple example of how a page that uses fetch would be set up.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// some page.js file as an example</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">Page</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://some.api.com/example</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> resp <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>resp<span class="token punctuation">.</span>ok<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//handle the error and tell the user</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token punctuation">{</span>Error message <span class="token keyword">for</span> user<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token comment">//throwing an error here without a catch will trigger loading the error.js file.</span>
  <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
    <span class="token comment">//render the content</span>
    <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token keyword">await</span> resp<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token punctuation">{</span><span class="token comment">/* This is the content for your page */</span><span class="token punctuation">}</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h3 id="props-params-and-searchparams"><a href="#props-params-and-searchparams" class="header-anchor">#</a> Props params and searchParams</h3> <p>When you have a dynamic route created by a folder name like <code>[category]</code>, the <code>props</code> object passed into the <code>page.js</code> file will include a property object called <code>params</code>, which will contain the value
from the URL as a property named after the folder.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// file - /[category]/.page.js</span>
<span class="token comment">// rendered from a URL of '/hello'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">Page</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//destructure props to pull out params</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> params <span class="token punctuation">}</span> <span class="token operator">=</span> props<span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// server side console output will be {category:'hello'}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>This means we can read the portion of the pathname of the url from <code>props.params</code>.</p> <p>If you have multiple dynamic route segments like <code>/[category]/[product]/details</code>, then the <code>props.params</code> object will contain the values for both <code>props.params.category</code> and <code>props.params.product</code>.</p> <p>Sometimes we also want to pass data directly to the page inside a dynamic route. Eg: <code>http://localhost:3000/groceries?id=123</code> to load the <code>/[category]/page.js</code> file and give it an id param from the
query string. So, in the example from the previous paragraph, <code>category</code> and <code>product</code> were both being passed as URL segment values. Instead of doing that, we can pass the category as a URL segment in
<code>props.params</code> and then the product id can be a value in the querystring. This approach will use the <code>props.searchParams</code> property object.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// page for `http://localhost:3000/groceries?id=123` is /[category]/page.js</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">Page</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//destructure props to pull out params (this can be done in the function declaration instead)</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> params<span class="token punctuation">,</span> searchParams <span class="token punctuation">}</span> <span class="token operator">=</span> props<span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// server side console output will be {category:'groceries'}</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>searchParams<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// server side console output will be 123</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>The query string values can be used in fetch calls or other ways to create specific data.</p> <h3 id="route-js-files"><a href="#route-js-files" class="header-anchor">#</a> route.js Files</h3> <p>Another fantastic capability that we get from NextJS is the ability to create API folders that are part of our website.</p> <p>To create endpoints for your own API, just create a folder and place a <code>route.js</code> files inside the folder. The convention is to add a folder called <code>api</code> inside of the <code>app</code> folder. All your route
folders will go inside the <code>api</code> folder. These <code>route.js</code> files are known as <code>Route Handlers</code>.</p> <p>Let's say that we want to have an API with the following end points:</p> <ul><li><code>https://localhost:3000/api/cats</code></li> <li><code>https://localhost:3000/api/dogs</code></li></ul> <p>It will have the following directory structure:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>- app
  - api
    - cats
      - route.js
    - dogs
      - route.js
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>Inside each of the <code>route.js</code> files, you can create an exported function named for each HTTP Verb.</p> <div class="custom-block tip"><p class="custom-block-title">route.js Function Names</p> <p>The names of the functions inside a route.js file can only be:</p> <p><strong>GET, POST, PUT, PATCH, DELETE, OPTIONS, HEAD</strong></p></div> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// /app/api/cats/route.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> cookies<span class="token punctuation">,</span> headers <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'next/headers'</span><span class="token punctuation">;</span>
<span class="token comment">//import cookies to be able to access, get cookie values from the request</span>
<span class="token comment">//import headers to directly access ALL the headers in the request</span>

<span class="token comment">// inside any function you can do something like this:</span>
<span class="token comment">//const cookieStore = cookies()</span>
<span class="token comment">//const token = cookieStore.get('token')</span>
<span class="token comment">//const headersList = headers()</span>
<span class="token comment">//const referer = headersList.get('referer')</span>
<span class="token comment">//both these can also be accessed from the request object</span>


<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token constant">GET</span><span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//each method function will get passed the request object</span>
  <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> params <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URLSearchParams</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//each method should return a response object</span>
  <span class="token comment">//we can do a fetch call to another api from here</span>
  <span class="token keyword">let</span> resp <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'some other api url'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'GET'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">accept</span><span class="token operator">:</span> <span class="token string">'application/json'</span><span class="token punctuation">,</span>
      <span class="token string-property property">'API-Key'</span><span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">DATA_API_KEY</span><span class="token punctuation">,</span>
      <span class="token comment">//read a value from environment variables for the api key</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">next</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">revalidate</span><span class="token operator">:</span> <span class="token number">60</span> <span class="token punctuation">}</span>
    <span class="token comment">//we can set the results as valid for 60 seconds</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//With a route.js file we are building a custom Response object</span>
  <span class="token comment">// this response can be anything... text, xml, json, html, images, etc</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span><span class="token string">'contents of response'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string-property property">'content-type'</span><span class="token operator">:</span> <span class="token string">'text/plain'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token constant">POST</span><span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//each method function will get passed the request object</span>
  <span class="token comment">//function can be async if you plan to do something asynchronous</span>
  <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> params <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URLSearchParams</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//we can do fetch calls from here too</span>
  <span class="token keyword">let</span> resp <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'some other api url'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">accept</span><span class="token operator">:</span> <span class="token string">'application/json'</span><span class="token punctuation">,</span>
      <span class="token string-property property">'API-Key'</span><span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">DATA_API_KEY</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    <span class="token literal-property property">body</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">123</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Steve'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>resp<span class="token punctuation">.</span>ok<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span><span class="token string">'{&quot;code&quot;:444, &quot;message&quot;:&quot;fail&quot;}'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">'content-type'</span><span class="token operator">:</span> <span class="token string">'application/json'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token number">444</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">//extract the json data from the fetch</span>
  <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> resp<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//convert or select whatever part you want then return it</span>
  <span class="token keyword">return</span> Response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> data <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token constant">PATCH</span><span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token constant">PUT</span><span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token constant">DELETE</span><span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token constant">HEAD</span><span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token constant">OPTIONS</span><span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br></div></div><p>You can create a function for any HTTP methods you need. They can return any type of response you need. They can return JSON, HTML, XML, text, or even images.</p> <p>Since this code is all running on the server side, it means that we can also access <strong>Environment variables</strong> from the server. Notice inside the <code>fetch</code> call in the <code>POST</code> function there is a header
that uses <code>process.env.DATA_API_KEY</code> as its value.</p> <p>In NodeJS you can use <code>process.env</code> to access any and all environment variables on the server.</p> <div class="language-txt line-numbers-mode"><pre class="language-txt"><code>// .env file
API_KEY=kj3kjhw3kjh43k4gk4jh32k24h9sd8998sd7f
TMDB_TOKEN=3jy48367373.skjhfskjhsdkjfhskdfjhskdf.kj2hk4h3k4jh3khjf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>In the hidden <code>.env</code> file you can list your API keys and tokens. This file is typically NOT uploaded to your Repo. It is used locally in your dev environment. Then on Vercel, or whatever your hosting
environment is, you will define the ENV variables through the dashboard.</p> <p>Then in your <code>route.js</code> or <code>page.js</code> files you can read these values.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//route.js or page.js</span>
<span class="token keyword">const</span> <span class="token constant">APIKEY</span> <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">API_KEY</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>If you are using Vercel or Netlify, then part of the configuration for any project will include creating environment variables to hold things like API keys.</p> <p>Additionally, all the fetch call results will automatically be cached. Inside the <code>fetch()</code> options object we can add a property called <code>next</code> whose value will be an object with a <code>revalidate</code>
property that holds a number of seconds. This is the length of time to hold the fetch results in the cache, to save processing time and bandwidth.</p> <h3 id="server-side-redirects"><a href="#server-side-redirects" class="header-anchor">#</a> Server-Side Redirects</h3> <p>If you ever want to do a redirect on the server-side to a different URL then you can import and use the <code>redirect</code> method like the following.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> redirect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'next/navigation'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">Page</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'https://nextjs.org/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="custom-paths-for-imports"><a href="#custom-paths-for-imports" class="header-anchor">#</a> Custom Paths for Imports</h3> <p>When creating your components or pages, the paths to your imports are relative. They will be different depending on which file is doing the importing.</p> <p>NextJS has a great solution to simplify your imports.</p> <p>With the following directory structure, let's say we are building the <code>page.js</code> file inside the <code>/app/[category]/product/</code> folder.</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>- app
  - components
    - Header.js
  - [category]
    - page.js
    - product
      - page.js
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>The standard way for <code>product/page.js</code> to import the <code>Header.js</code> component would be:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> Header <span class="token keyword">from</span> <span class="token string">'../../components/Header'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>If <code>[category]/page.js</code> were importing the same file, then the import would be:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> Header <span class="token keyword">from</span> <span class="token string">'../components/Header'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>As your application becomes more complex, the calculating of imports can become even more difficult too. To address this, we have a different import syntax for NextJS that we can use.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> Header <span class="token keyword">from</span> <span class="token string">'@/app/components/Header'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>The <code>@/app</code> is a direct pointer to the app folder from anywhere in the directory structure.</p> <p>You can build your own custom import shortcuts by editing the <code>jsconfig.json</code> file.</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;compilerOptions&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;paths&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;@/*&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;./*&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token property">&quot;@/comp/*&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;./app/components/*&quot;</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>The preceding example shows how to create a custom path prefix <code>@/comp/</code> that points to the <code>/app/components/</code> folder. So, if you want to import a component called <code>navbar.js</code> from inside the
components folder, you would write the import like this:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> NavBar <span class="token keyword">from</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">@/comp/navbar.js</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token comment">//this path works from anywhere in your app.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="server-actions"><a href="#server-actions" class="header-anchor">#</a> Server Actions</h2> <p>Server Actions are a powerful new feature in NextJS. They let you create a server-side function for handling form submissions. The contents of the form will be streamed to the function for processing
as a <code>FormData</code> object. You can picture this like doing a fetch call to POST the FormData to a server-side endpoint. The user stays on the same webpage.</p> <p>After processing the FormData you will have three options in the server-side function:</p> <ol><li>Call <code>revalidatePath</code> which tells the server-side cache that whatever path you give it is no longer valid. The next time the user visits the revalidated path they WILL get a new build of the page.</li> <li>Call <code>redirect</code> and do a server-side redirect. This will tell the browser to load a new page in place of the one that contained the form.</li> <li>Do nothing other than accept and process the data on the server-side.</li></ol> <p>First, in your <code>&lt;form&gt;</code> you will use an <code>action</code> attribute instead of an <code>onSubmit</code> attribute. The value of the <code>action</code> will be the name of the function inside the page function that contains the
form.</p> <p>When the <code>handleSubmit</code> server-side function is called, it means that NextJS has bundled everything in your Form as a FormData object and sent it to the server. The FormData object will be extracted
from the Request object and passed to your server-side <code>Server Action</code> function.</p> <p>You MUST add the <code>use server</code> directive as the first line inside your function.</p> <p>All Server Action functions MUST be <code>async</code>.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// /something/page.js</span>
<span class="token keyword">import</span> MySubmitButton <span class="token keyword">from</span> <span class="token string">'@/app/components/MySubmitButton'</span><span class="token punctuation">;</span> <span class="token comment">//a client side component</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">handleSubmit</span><span class="token punctuation">(</span><span class="token parameter">formData</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token string">'use server'</span><span class="token punctuation">;</span>
    <span class="token comment">//await fetch or whatever async thing you want</span>
    <span class="token comment">//then tell the current route to update itself</span>
    <span class="token function">revalidatePath</span><span class="token punctuation">(</span><span class="token string">'/something'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>form action<span class="token operator">=</span><span class="token punctuation">{</span>handleSubmit<span class="token punctuation">}</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;text&quot;</span> placeholder<span class="token operator">=</span><span class="token string">&quot;Your name&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>MySubmitButton <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>form<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>A common practice with Server Action functions is to place them all inside a file called <code>actions.js</code> inside the <code>/app</code> folder. All the <code>async</code> functions inside of <code>actions.js</code> get exported and then
imported into the page(s) that need them.</p> <h3 id="useformstatus-hook"><a href="#useformstatus-hook" class="header-anchor">#</a> useFormStatus Hook</h3> <p>Since all the forms that are being completed by the user are <code>use client</code> components, it means that you can use React <code>hooks</code> inside the component. A NEW hook that has been added along with Server
Action functions is the <code>useFormStatus</code> hook.</p> <p>The submit button client-side component can use the <code>useFormStatus</code> hook's <code>pending</code> value to determine the current status of the <code>&lt;form&gt;</code>. This is waiting for the form data to be sent to the server
and a Promise resolved signal back from the server indicating that the server action is complete.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token string">'use client'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useFormStatus <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-dom'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">SubmitButton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> pending <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useFormStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>button disabled<span class="token operator">=</span><span class="token punctuation">{</span>pending<span class="token punctuation">}</span> className<span class="token operator">=</span><span class="token string">&quot;disabled:bg-zinc-500&quot;</span><span class="token operator">&gt;</span>
      Click Me
    <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>With the <code>disabled</code> attribute in the button using the <code>pending</code> value, it will be set as disabled after the first time the user clicks the button. It will not get re-enabled until the result is
streamed back from the server.</p> <p>Any time you have a simple async task to complete on the server, <code>Server Actions</code> are a quick and easy way to handle this.</p> <p>Another way that you can manage your server actions is to create a single file at the root called <code>actions.js</code>. Place all your server action functions inside this file and have the <code>use server</code>
directive at the top of the file. With the file marked as a server side script you can import any of the functions into your client components elsewhere in your app.</p> <p>Here is an example of an <code>actions.js</code> file with a couple server action functions. <strong>Remember that action functions must be async.</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// /app/actions.js</span>
<span class="token string">'use server'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> revalidatePath <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'next/cache'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> redirect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'next/navigation'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">zeroOne</span><span class="token punctuation">(</span><span class="token parameter">something</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> num <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//return 0 or 1</span>
  <span class="token comment">//save the value somewhere that can be retrieved when page.js runs again</span>
  <span class="token comment">//then call revalidatePath or redirect</span>
  <span class="token function">revalidatePath</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>something<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//revalidatePath means that this path is no longer cached</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">waitZeroOne</span><span class="token punctuation">(</span><span class="token parameter">something</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//return 0 or 1 after a 2 second delay</span>
  <span class="token keyword">let</span> num <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//save the value somewhere that can be retrieved when page.js runs again</span>
  <span class="token comment">// revalidatePath(`/${something}`);</span>
  <span class="token function">redirect</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>something<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">?</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>num<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>The server action functions can call:</p> <ul><li><code>revalidatePath()</code> from <code>'next/cache'</code> to clear the cached copy of the path.</li> <li>or <code>redirect()</code> from <code>'next/navigation'</code> to send the user to a new <code>page.js</code>.</li></ul> <p>Then we import those functions in our client side component with event handling.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// /app/components/MyButton.js</span>
<span class="token string">'use client'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> waitZeroOne <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/app/actions'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">MyButton</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> page <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;p-8&quot;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">waitZeroOne</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>click me<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>The client side button component needs to be used in a page, of course.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// /app/[something]/page.js</span>

<span class="token keyword">import</span> MyButton <span class="token keyword">from</span> <span class="token string">'@/app/components/MyButton'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Page</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> params<span class="token punctuation">,</span> searchParams <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> something <span class="token punctuation">}</span> <span class="token operator">=</span> params<span class="token punctuation">;</span>
  <span class="token keyword">const</span> num <span class="token operator">=</span> searchParams<span class="token punctuation">.</span>num<span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;p-8&quot;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>h1 className<span class="token operator">=</span><span class="token string">&quot;p-8&quot;</span><span class="token operator">&gt;</span>Page <span class="token punctuation">{</span>something<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
      <span class="token punctuation">{</span>num <span class="token operator">&amp;&amp;</span> <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>The number is <span class="token punctuation">{</span>num<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span><span class="token punctuation">}</span>
      <span class="token operator">&lt;</span>MyButton page<span class="token operator">=</span><span class="token punctuation">{</span>something<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>The path part of the url is passed to the button through props. The button calls the server action. Then the server action function has to call revalidate so the generated value can be passed back to
the page. In this example, the pathname is passed to the server action function.</p> <p>Here is a <a href="https://github.com/prof3ssorSt3v3/bookish-waddle" target="_blank" rel="noopener noreferrer">repo with a demo of the Server Actions tied to a form<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. It takes two values from a form and uses one for the folder name and the second as
a querystring value.</p> <h2 id="error-handling"><a href="#error-handling" class="header-anchor">#</a> Error Handling</h2> <p>Another built-in file that Next.js provides is the <code>error.js</code> file. In each folder (URL segment), if you add an error.js file then it will handle uncaught errors in your code.</p> <p>What does that mean?</p> <p>Well, it means that if your code throws a JavaScript error and there is no <code>catch</code> block to capture the error, then the error object will be passed to the error.js file and its default export
function.</p> <p>The <code>error.js</code> file becomes a replacement for the <code>page.js</code> file. It will be the webpage that the user sees instead of whatever URL is in the location bar of the browser. So, remember to provide
options to the user.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token string">'use client'</span><span class="token punctuation">;</span>
<span class="token comment">//error.js should be a client side component</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Error</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> error<span class="token punctuation">,</span> reset <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//error is an actual JS Error Object</span>
  <span class="token comment">//if you put a JSON string into the Error when it gets thrown</span>
  <span class="token comment">//then you can decode it here</span>
  <span class="token keyword">const</span> errObj <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token punctuation">{</span>error<span class="token punctuation">.</span>message<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token operator">&lt;</span>Link href<span class="token operator">=</span><span class="token string">&quot;/&quot;</span><span class="token operator">&gt;</span>Back to Home Page<span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>button
            onClick<span class="token operator">=</span><span class="token punctuation">{</span>
              <span class="token comment">// Attempt to recover by trying to re-render the segment</span>
              <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
          <span class="token operator">&gt;</span>
            Try Again
          <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>The <code>error.js</code> page should have styles to replicate the layout used on other parts of your website.</p> <p>The <code>reset</code> parameter passed through props to the Error function is a function that will try to re-render the current URL segment.</p> <p>Now, you can do whatever you like with the error object that gets passed to the <code>error.js</code> file. It can be just a typical <code>Error</code> object with a <code>name</code> and a <code>message</code> property. If you want to write
your code to handle that, fine.</p> <p>However, there is an opportunity here to provide a lot more information to the error.js page. You can create your own custom object filled with details about the error, and turn that into a JSON
string. Then pass that string to the Error object to be parse inside of <code>error.js</code>.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//version 1 - a basic error object</span>
<span class="token keyword">let</span> err1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Just a typical error to be thrown'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">throw</span> err1<span class="token punctuation">;</span>

<span class="token comment">//version 2 - an error containing JSON</span>
<span class="token keyword">let</span> myErrorObject <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">code</span><span class="token operator">:</span> <span class="token number">1234</span><span class="token punctuation">,</span>
  <span class="token literal-property property">details</span><span class="token operator">:</span> <span class="token string">'Failed to fetch the data for the id'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">ref</span><span class="token operator">:</span> searchParams<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">httpStatus</span><span class="token operator">:</span> response<span class="token punctuation">.</span>status<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> json <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>myErrorObject<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> err2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">throw</span> err2<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>With a JSON string you can put any details that you want about the error into the string. That string can be passed through a generic <code>Error</code> object.</p> <p>An alternative to this is you could build your own custom error objects. This way you will have error types that you can check for inside of the error page.</p> <p><a href="https://dev.to/prof3ssorst3v3/create-your-own-custom-js-error-type-5e1j" target="_blank" rel="noopener noreferrer">Here is a short written tutorial on building your own custom error objects<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>or if you prefer, a video tutorial about the same thing.</p> <div title="Custom Error objects in JavaScript" class="video-player"><iframe width="560" height="315" src="https://www.youtube.com/embed/iJVNtQ7y8_U" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; fullscreen" allowfullscreen="allowfullscreen"></iframe></div> <p>So, you can build and throw errors inside of a Server Action (<code>actions.js</code>) or inside of a <code>page.js</code> file that use this technique.</p> <p>Inside of a <code>route.js</code> file you are already building a JSON response. So, the JSON that you return can include all the error information and you will use the HTTP Response status code as the flag that
an error has happened.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//route.js</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token constant">GET</span><span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//pretending that an error has happened...</span>
  <span class="token keyword">let</span> errobj <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">code</span><span class="token operator">:</span> <span class="token number">1234</span><span class="token punctuation">,</span>
    <span class="token literal-property property">details</span><span class="token operator">:</span> <span class="token string">'Failed to fetch the data for the id'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">ref</span><span class="token operator">:</span> searchParams<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> json <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>errobj<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> resp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span>json<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">'content-type'</span><span class="token operator">:</span> <span class="token string">'application/json'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token number">475</span><span class="token punctuation">,</span> <span class="token comment">//custom HTTP status code about there being a problem</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> resp<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p><a href="https://github.com/prof3ssorSt3v3/stunning-giggle" target="_blank" rel="noopener noreferrer">This repo shows a working example of an error.js file handling an error that happens inside a Server Action function<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="suspense"><a href="#suspense" class="header-anchor">#</a> Suspense</h2> <p>The <code>&lt;Suspense fallback=&quot;&quot;&gt;</code> component that we discussed in React, works well with NextJS too.</p> <p>In this following example, there is a dynamic component that will be making a fetch call using an async component function. We want the rest of the page to appear in the browser before the fetch
completes. When completed, we want the contents of the dynamic component to be streamed to the browser and replace the <code>&lt;Suspense&gt;</code>.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// app/page.js</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span>Suspense<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> TheDynamicDataComponent <span class="token keyword">from</span> <span class="token string">'@/app/components/TheDynamicDataComponent'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>main<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>header<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>Static Masthead content<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>header<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>section<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Suspense fallback<span class="token operator">=</span><span class="token string">'&lt;p&gt;Loading...&lt;/p&gt;'</span><span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>TheDynamicDataComponent <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>Suspense<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>section<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>footer<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>Static footer content<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>footer<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>main<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>And here is an example of a the <code>TheDynamicDataComponent</code>.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// /app/components/TheDynamicDataComponent.js</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">TheDynamicDataComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//Note the async</span>
  <span class="token comment">//fake a fetch call</span>
  <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//wait 3 seconds before continuing</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>This is the dynamic data that took <span class="token number">3</span> seconds to build<span class="token punctuation">.</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h2 id="middleware"><a href="#middleware" class="header-anchor">#</a> Middleware</h2> <p>When you build APIs with NodeJS and Express, you are frequently using middleware. These are functions that run as part of a sequence that starts when the HTTP request arrives at the server and
finishes with the server sending the response back to the browser.</p> <p>NextJS also has middleware. These are functions that can run before your <code>page.js</code>.</p> <p>They are most commonly used when you need to do something like validate a user before sending a response. You can use the middleware to do anything you want though. To create the middleware, simply
add a file called <code>middleware.js</code> inside your <code>app</code> folder and give it a function named <code>middleware</code> and a variable called <code>config</code>.</p> <p>The <code>middleware</code> function will automatically be called (convention over configuration). It will be passed the request object.</p> <p>The <code>config</code> variable needs to contain an object with a property called <code>matcher</code>. The <code>matcher</code> property will hold an array with a list of routes to match. For each of these routes, the <code>middleware</code>
function will be called before your <code>page.js</code>.</p> <blockquote><p>If you <strong>don't</strong> have the <code>config</code> variable then the <code>middleware</code> function will run for EVERY request.</p></blockquote> <p>The request parameter passed to the <code>middleware</code> function will be a <code>NextRequest</code> object. You need to import the <code>NextRequest</code> and <code>NextResponse</code> objects from <code>next/server</code>. The <code>middleware</code> function
needs to return a call <code>NextResponse.next()</code>, which will trigger the next step in the process of layout.js -&gt; page.js -&gt; components, etc. that ends with sending the response to the browser.</p> <p>Inside your <code>middleware</code> function you will be able to do server-side redirects to other pages if you want. Just use the <code>NextResponse.redirect()</code> method.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> NextResponse<span class="token punctuation">,</span> NextRequest <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'next/server'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">middleware</span><span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> isAuthenticated <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isAuthenticated<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> NextResponse<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> NextResponse<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">matcher</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'/dashboard'</span><span class="token punctuation">,</span> <span class="token string">'/account'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>Inside your <code>middleware</code> function, the idea is that you will be provided with the <code>request</code> parameter (which is a <code>NextRequest</code> object). If the function returns nothing then NextJS will just move on
to building the appropriate end point (layout.js, page.js, route.js, etc).</p> <p>The HTTP Request object that you receive will have the full URL object, the headers, the cookies which were previously set in the browser, and the querystring. The <code>NextRequest</code> object is a
convenience object that makes it easier to get these property values. It has a property called <code>nextUrl</code> that gives you all the parts of the URL. It has a property called <code>cookies</code> which contains all
the cookies currently set in the browser. It also has an <code>ip</code> property with the IP address for the request.</p> <p>Additionally, if you are hosting your code on Vercel, <code>NextRequest</code> will also contain an <code>geo</code> object that contains the latitude and longitude for the request.</p> <p><a href="https://nextjs.org/docs/pages/api-reference/functions/next-request" target="_blank" rel="noopener noreferrer">full reference for NextRequest object<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">middleware</span><span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> path <span class="token operator">=</span> request<span class="token punctuation">.</span>nextUrl<span class="token punctuation">.</span>pathname<span class="token punctuation">;</span> <span class="token comment">//the request url path (the part after the origin)</span>
  <span class="token keyword">let</span> params <span class="token operator">=</span> request<span class="token punctuation">.</span>nextUrl<span class="token punctuation">.</span>searchParams<span class="token punctuation">;</span> <span class="token comment">//the querystring object with get() and has() methods</span>
  <span class="token keyword">let</span> origin <span class="token operator">=</span> request<span class="token punctuation">.</span>nextUrl<span class="token punctuation">.</span>origin<span class="token punctuation">;</span> <span class="token comment">//the request origin eg: http://localhost:3000</span>

  <span class="token keyword">let</span> hasToken <span class="token operator">=</span> request<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span><span class="token string">'token'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//Boolean - does the browser have a cookie called token</span>
  <span class="token keyword">let</span> token <span class="token operator">=</span> request<span class="token punctuation">.</span>cookiest<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'token'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//string value of the token cookie</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>If you DO return something from the function then it needs to be an initial HTTP Response object, which will be then passed along and have the appropriate endpoint built on top of it.</p> <p>You create the HTTP Response object with one of two methods:</p> <ul><li><code>NextResponse.next()</code> which creates the container that will hold the endpoint requested in the <code>request</code> parameter.</li> <li><code>NextResponse.redirect()</code> which will be the container for a new endpoint that you define.</li></ul> <p>Both of these methods return a Response object that you can put into a variable or you can just return it from the function.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> NextResponse <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'next/server'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">middleware</span><span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> response <span class="token operator">=</span> NextResponse<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  response<span class="token punctuation">.</span>headers<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'X-myheader'</span><span class="token punctuation">,</span> <span class="token string">'Some value'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> response<span class="token punctuation">;</span>
  <span class="token comment">//or just...</span>
  <span class="token comment">//return NextResponse.next();</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>The reason you would put the response object into a variable is so that you can edit things like the headers or cookies that will be returned to the page endpoint.</p> <p>A common use case for the middleware function would be when you are having a user log in to the website. You receive a JWT token string through the querystring and you need to set the value as a
cookie.</p> <p>To set the cookie you need to add the cookie to Response object headers so it can be passed to the client-side and saved in the browser.</p> <h2 id="cookies"><a href="#cookies" class="header-anchor">#</a> Cookies</h2> <p>A cookie is just a string that gets passed between client and server as an HTTP header.</p> <p>When a browser sends an HTTP Request to the server for a resource of the same origin as the current page, and there is currently a cookie set in the browser, then the cookie will be sent as a header.</p> <p>The JavaScript Request object could look like this:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> req <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Request</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'GET'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">cookie</span><span class="token operator">:</span> <span class="token string">'username=archer;path=/;maxAge=3600;httpOnly;secure'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>A <strong>Request</strong> object can have a header called <code>cookie</code>. This will be the contents of the cookie from the browser.</p> <p>A <strong>Response</strong> object can have a header called <code>set-cookie</code>. This is an instruction from the server to the browser to save a cookie with those settings.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> resp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span><span class="token string">'&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;Some web page content&lt;/body&gt;&lt;/html&gt;'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">'content-type'</span><span class="token operator">:</span> <span class="token string">'text/html'</span><span class="token punctuation">,</span>
    <span class="token string-property property">'set-cookie'</span><span class="token operator">:</span> <span class="token string">'username=archer;path=/;maxAge=3600;httpOnly;secure'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>If you are writing client-side JavaScript, and you are wanting to create a non-httpOnly cookie, then you can use <code>document.cookie = 'username=archer'</code> to set a cookie in the browser. Then next time
you make a request from the browser the cookie will be sent in the <code>cookie</code> header along with the Request.</p> <p>When you are using NextJS middleware, you will get a <code>request</code> parameter in the function that you can use to read the value of any cookies.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">middleware</span><span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>If you want to send a cookie to the browser then you have to do this on the Response object.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> NextResponse <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'next/server'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">middleware</span><span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> response <span class="token operator">=</span> NextResponse<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  response<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">,</span> <span class="token string">'archer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> response<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>Now, the limitation in the above approach is that you do not have any control over the additional cookie settings.</p> <p><a href="https://mad9014.github.io/W2024/modules/browser-js/week11/security/#cookies" target="_blank" rel="noopener noreferrer">Here is a longer reference to the basic cookie parameters<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>To get past the limitations of the <code>response.cookies.set</code> method, and to be able to change the various other parameters, then you will need to use the <code>cookies()</code> method imported from <code>next/headers</code>.</p> <p>The <code>cookies()</code> method can be used inside middleware.js or any other file. However, if you want to use <code>cookies().set()</code>, then you need to use it inside a Server Action function or a <code>route.js</code> file.</p> <p>So, we import the function from <code>actions.js</code> into <code>middleware.js</code> and then call the function to set the cookie.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// /app/actions.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> cookies <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'next/headers'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">setCookie</span><span class="token punctuation">(</span><span class="token parameter">_name<span class="token punctuation">,</span> _value<span class="token punctuation">,</span> age</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">cookies</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> _name<span class="token punctuation">,</span>
    <span class="token literal-property property">value</span><span class="token operator">:</span> _value<span class="token punctuation">,</span>
    <span class="token literal-property property">secure</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">httpOnly</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">maxAge</span><span class="token operator">:</span> age<span class="token punctuation">,</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// /middleware.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> NextResponse <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'next/server'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> setCookie <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/app/actions.js'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">middleware</span><span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> response <span class="token operator">=</span> NextResponse<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">setCookie</span><span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">,</span> <span class="token string">'archer'</span><span class="token punctuation">,</span> <span class="token number">3600</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> response<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div> <h2 id="what-to-do-this-week"><a href="#what-to-do-this-week" class="header-anchor">#</a> What to do this week</h2> <div class="custom-block warning"><p class="custom-block-title">TODO Things to do before next week.</p> <ul><li>Read all the content from <code>Modules 13.1, 13.2, and 14.1</code>.</li> <li>Keep watching the <a href="https://www.youtube.com/watch?v=IkkzjbdIOBM&amp;list=PLyuRouwmQCjmMfs-HOsDGoaN6JiYrC6Ms" target="_blank" rel="noopener noreferrer">React in 2021 Video Tutorial Playlist<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">5/16/2024, 10:02:18 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      
      <a href="/s2024/modules/react/week12/12.2/" class="prev">
        12.2: NextJS Routing
      </a></span> <span class="next"><a href="/s2024/modules/react/week13/13.2/">
        13.2: Styling and Theming
      </a>
      
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/s2024/assets/js/app.800de6cb.js" defer></script><script src="/s2024/assets/js/2.65264708.js" defer></script><script src="/s2024/assets/js/45.8da8f59f.js" defer></script><script src="/s2024/assets/js/9.005e1e8c.js" defer></script><script src="/s2024/assets/js/11.87711128.js" defer></script>
  </body>
</html>
