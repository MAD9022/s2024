<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>3.1 Data Storage &amp; Manipulation | MAD9022</title>
    <meta name="generator" content="VuePress 1.9.8">
    
    <meta name="description" content="Fullstack: Frontend Development Course">
    
    <link rel="preload" href="/s2024/assets/css/0.styles.0189e570.css" as="style"><link rel="preload" href="/s2024/assets/js/app.800de6cb.js" as="script"><link rel="preload" href="/s2024/assets/js/2.65264708.js" as="script"><link rel="preload" href="/s2024/assets/js/35.e656cbcf.js" as="script"><link rel="preload" href="/s2024/assets/js/9.005e1e8c.js" as="script"><link rel="preload" href="/s2024/assets/js/11.87711128.js" as="script"><link rel="prefetch" href="/s2024/assets/js/10.912d3f44.js"><link rel="prefetch" href="/s2024/assets/js/12.1ad3b3b9.js"><link rel="prefetch" href="/s2024/assets/js/13.5c6eca3c.js"><link rel="prefetch" href="/s2024/assets/js/14.a39ca56d.js"><link rel="prefetch" href="/s2024/assets/js/15.fea1e72e.js"><link rel="prefetch" href="/s2024/assets/js/16.6b8223ef.js"><link rel="prefetch" href="/s2024/assets/js/17.db7cf2f4.js"><link rel="prefetch" href="/s2024/assets/js/18.7759db48.js"><link rel="prefetch" href="/s2024/assets/js/19.bb0f2052.js"><link rel="prefetch" href="/s2024/assets/js/20.3f3d5c16.js"><link rel="prefetch" href="/s2024/assets/js/21.23f944a3.js"><link rel="prefetch" href="/s2024/assets/js/22.32b2777d.js"><link rel="prefetch" href="/s2024/assets/js/23.aa560bd2.js"><link rel="prefetch" href="/s2024/assets/js/24.1160513f.js"><link rel="prefetch" href="/s2024/assets/js/25.257a77d2.js"><link rel="prefetch" href="/s2024/assets/js/26.9c34cefb.js"><link rel="prefetch" href="/s2024/assets/js/27.b2ff0a06.js"><link rel="prefetch" href="/s2024/assets/js/28.d09f9311.js"><link rel="prefetch" href="/s2024/assets/js/29.a0941762.js"><link rel="prefetch" href="/s2024/assets/js/3.544714c7.js"><link rel="prefetch" href="/s2024/assets/js/30.47ebd370.js"><link rel="prefetch" href="/s2024/assets/js/31.ece81fbc.js"><link rel="prefetch" href="/s2024/assets/js/32.ae206ed9.js"><link rel="prefetch" href="/s2024/assets/js/33.9514a6a6.js"><link rel="prefetch" href="/s2024/assets/js/34.583d401c.js"><link rel="prefetch" href="/s2024/assets/js/36.cacc60df.js"><link rel="prefetch" href="/s2024/assets/js/37.1d4e63ca.js"><link rel="prefetch" href="/s2024/assets/js/38.4711b180.js"><link rel="prefetch" href="/s2024/assets/js/39.28fe2c35.js"><link rel="prefetch" href="/s2024/assets/js/4.a59aad47.js"><link rel="prefetch" href="/s2024/assets/js/40.7a728e12.js"><link rel="prefetch" href="/s2024/assets/js/41.102054ba.js"><link rel="prefetch" href="/s2024/assets/js/42.e4927ef8.js"><link rel="prefetch" href="/s2024/assets/js/43.991ea947.js"><link rel="prefetch" href="/s2024/assets/js/44.8db11b89.js"><link rel="prefetch" href="/s2024/assets/js/45.8da8f59f.js"><link rel="prefetch" href="/s2024/assets/js/46.e4ae4586.js"><link rel="prefetch" href="/s2024/assets/js/47.3a64f81f.js"><link rel="prefetch" href="/s2024/assets/js/48.85a59034.js"><link rel="prefetch" href="/s2024/assets/js/49.d9dd3379.js"><link rel="prefetch" href="/s2024/assets/js/5.6426ebe4.js"><link rel="prefetch" href="/s2024/assets/js/50.51e2c9f2.js"><link rel="prefetch" href="/s2024/assets/js/51.bcc581ae.js"><link rel="prefetch" href="/s2024/assets/js/52.42daf800.js"><link rel="prefetch" href="/s2024/assets/js/6.2beeeb0e.js"><link rel="prefetch" href="/s2024/assets/js/7.64cbf74e.js"><link rel="prefetch" href="/s2024/assets/js/8.e15ce9b2.js">
    <link rel="stylesheet" href="/s2024/assets/css/0.styles.0189e570.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/s2024/" class="home-link router-link-active"><img src="/s2024/mad-d-logo-sm.png" alt="MAD9022" class="logo"> <span class="site-name can-hide">MAD9022</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/s2024/overview/" class="nav-link">
  Overview
</a></div><div class="nav-item"><a href="/s2024/assignments/" class="nav-link">
  Deliverables
</a></div><div class="nav-item"><a href="/s2024/resources/" class="nav-link">
  Resources
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/s2024/overview/" class="nav-link">
  Overview
</a></div><div class="nav-item"><a href="/s2024/assignments/" class="nav-link">
  Deliverables
</a></div><div class="nav-item"><a href="/s2024/resources/" class="nav-link">
  Resources
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Hybrid</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>PWA</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/s2024/modules/pwas/week1/1.1/" class="sidebar-link">1.1: Promises &amp; Fetch</a></li><li><a href="/s2024/modules/pwas/week1/1.2/" class="sidebar-link">1.2: Git &amp; Pull Requests</a></li><li><a href="/s2024/modules/pwas/week2/2.1/" class="sidebar-link">2.1: Web Storage, Cookies, &amp; Cache</a></li><li><a href="/s2024/modules/pwas/week2/2.2/" class="sidebar-link">2.2: Cache, Files &amp; Responses</a></li><li><a href="/s2024/modules/pwas/week3/3.1/" aria-current="page" class="active sidebar-link">3.1: Storage &amp; Data Manipulation</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/s2024/modules/pwas/week3/3.1/#cache-api-summary" class="sidebar-link">Cache API Summary</a></li><li class="sidebar-sub-header"><a href="/s2024/modules/pwas/week3/3.1/#how-do-i" class="sidebar-link">How Do I???</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/s2024/modules/pwas/week3/3.1/#open-a-cache-and-keep-a-reference" class="sidebar-link">Open a Cache and keep a Reference</a></li><li class="sidebar-sub-header"><a href="/s2024/modules/pwas/week3/3.1/#get-a-list-of-caches" class="sidebar-link">Get a List of Caches</a></li><li class="sidebar-sub-header"><a href="/s2024/modules/pwas/week3/3.1/#delete-old-caches" class="sidebar-link">Delete Old Caches</a></li><li class="sidebar-sub-header"><a href="/s2024/modules/pwas/week3/3.1/#get-a-list-of-files-in-a-cache" class="sidebar-link">Get a List of Files in a Cache</a></li><li class="sidebar-sub-header"><a href="/s2024/modules/pwas/week3/3.1/#delete-a-file-in-a-cache" class="sidebar-link">Delete a File in a Cache</a></li><li class="sidebar-sub-header"><a href="/s2024/modules/pwas/week3/3.1/#add-a-file-to-a-cache" class="sidebar-link">Add a File to a Cache</a></li><li class="sidebar-sub-header"><a href="/s2024/modules/pwas/week3/3.1/#get-the-contents-from-any-file" class="sidebar-link">Get the Contents from any File</a></li><li class="sidebar-sub-header"><a href="/s2024/modules/pwas/week3/3.1/#get-the-contents-from-a-text-file" class="sidebar-link">Get the Contents from a Text File</a></li><li class="sidebar-sub-header"><a href="/s2024/modules/pwas/week3/3.1/#get-the-contents-from-a-json-file" class="sidebar-link">Get the Contents from a JSON File</a></li><li class="sidebar-sub-header"><a href="/s2024/modules/pwas/week3/3.1/#get-the-contents-from-an-image-file" class="sidebar-link">Get the Contents from an Image File</a></li></ul></li><li class="sidebar-sub-header"><a href="/s2024/modules/pwas/week3/3.1/#more-data-storage" class="sidebar-link">More Data Storage</a></li><li class="sidebar-sub-header"><a href="/s2024/modules/pwas/week3/3.1/#indexeddb" class="sidebar-link">IndexedDB</a></li><li class="sidebar-sub-header"><a href="/s2024/modules/pwas/week3/3.1/#manipulating-data" class="sidebar-link">Manipulating Data</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/s2024/modules/pwas/week3/3.1/#basic-object-manipulation" class="sidebar-link">Basic Object Manipulation</a></li><li class="sidebar-sub-header"><a href="/s2024/modules/pwas/week3/3.1/#accessing-properties" class="sidebar-link">Accessing Properties</a></li><li class="sidebar-sub-header"><a href="/s2024/modules/pwas/week3/3.1/#iterable-manipulation" class="sidebar-link">Iterable Manipulation</a></li></ul></li><li class="sidebar-sub-header"><a href="/s2024/modules/pwas/week3/3.1/#modules-namespaces-and-organizing-code" class="sidebar-link">Modules, Namespaces, and Organizing Code</a></li><li class="sidebar-sub-header"><a href="/s2024/modules/pwas/week3/3.1/#todo-this-week" class="sidebar-link">ToDo This Week</a></li></ul></li><li><a href="/s2024/modules/pwas/week3/3.2/" class="sidebar-link">3.2: Intro to Workers</a></li><li><a href="/s2024/modules/pwas/week4/4.1/" class="sidebar-link">4.1: Service Workers</a></li><li><a href="/s2024/modules/pwas/week4/4.2/" class="sidebar-link">4.2: Messaging &amp; Screen APIs</a></li><li><a href="/s2024/modules/pwas/week5/5.1/" class="sidebar-link">5.1: Intro to PWA</a></li><li><a href="/s2024/modules/pwas/week5/5.2/" class="sidebar-link">5.2: Audits, Offline Status, &amp; Service Worker Methods</a></li><li><a href="/s2024/modules/pwas/week6/6.1/" class="sidebar-link">6.1: PWA Concept Review</a></li><li><a href="/s2024/modules/pwas/week6/6.2/" class="sidebar-link">6.2: Web App Hosting</a></li><li><a href="/s2024/modules/pwas/week7/7.1/" class="sidebar-link">7.1: PWA Project</a></li><li><a href="/s2024/modules/pwas/week7/7.2/" class="sidebar-link">7.2: PWA Project</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>React</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><header><div class="section-title red">
    PWA
  </div> <h1>3.1 Data Storage &amp; Manipulation</h1> <div class="underdev no">Module Still Under Development</div></header> <h2 id="cache-api-summary"><a href="#cache-api-summary" class="header-anchor">#</a> Cache API Summary</h2> <h2 id="how-do-i"><a href="#how-do-i" class="header-anchor">#</a> How Do I???</h2> <p>So, for all these examples the assumed set up is a <code>main.js</code> file that imports a <code>cache.js</code> file. All the methods dealing with the cache(s) will be inside the <code>cache.js</code> file and will return a
<code>Promise</code>. Here is an example of a function inside the <code>main.js</code> file that calls a function in <code>cache.js</code> and receives a Promise in return. The code in <code>main.js</code> uses a <code>then()</code> to wait for the
completion of the code in <code>cache.js</code>.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//main.js</span>
<span class="token keyword">import</span> <span class="token constant">CACHE</span> <span class="token keyword">from</span> <span class="token string">'./cache.js'</span><span class="token punctuation">;</span>
<span class="token comment">// from inside a method in main.js we will call a method in cache.js</span>
<span class="token keyword">const</span> <span class="token constant">APP</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">cacheRef</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">//a variable to hold a reference to a cache.</span>
  <span class="token function">someFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token constant">CACHE</span><span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'my-cache-name'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">cache</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token constant">APP</span><span class="token punctuation">.</span>cacheRef <span class="token operator">=</span> cache<span class="token punctuation">;</span> <span class="token comment">//save the reference in the variable</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>If you need to do multiple things in a row, like open a cache, then delete a file, then get a list of all the files, then build the HTML for that list, then you need to use a chain of <code>.then()</code>
methods with a return of the Promise method inside each <code>then()</code>.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token constant">APP</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">someFunc</span><span class="token punctuation">(</span><span class="token parameter">filename</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token constant">CACHE</span><span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'my-cache-name'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">cache</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token constant">APP</span><span class="token punctuation">.</span>cacheRef <span class="token operator">=</span> cache<span class="token punctuation">;</span> <span class="token comment">//save the reference to the cache</span>
        <span class="token keyword">return</span> <span class="token constant">CACHE</span><span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">//now the delete is complete,</span>
        <span class="token comment">//get the list from the cache passed in</span>
        <span class="token keyword">return</span> <span class="token constant">CACHE</span><span class="token punctuation">.</span><span class="token function">getFiles</span><span class="token punctuation">(</span><span class="token constant">APP</span><span class="token punctuation">.</span>cacheRef<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">fileList</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">//fileList is the array of files</span>
        <span class="token comment">//build the HTML</span>
        <span class="token keyword">return</span> <span class="token constant">APP</span><span class="token punctuation">.</span><span class="token function">buildList</span><span class="token punctuation">(</span>fileList<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">//HTML is built... need to update anything else?</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">//handle an error from any step</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h3 id="open-a-cache-and-keep-a-reference"><a href="#open-a-cache-and-keep-a-reference" class="header-anchor">#</a> Open a Cache and keep a Reference</h3> <p>If all we need to do is open a cache and keep a reference to that cache for later use...</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token constant">CACHE</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">open</span><span class="token punctuation">(</span><span class="token parameter">cacheName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> caches<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="get-a-list-of-caches"><a href="#get-a-list-of-caches" class="header-anchor">#</a> Get a List of Caches</h3> <p>If you want a list of all the available caches...</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token constant">CACHE</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">listCaches</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> caches<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>Then back in the main JS file we get an array that we can loop through.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//main.js</span>
<span class="token constant">CACHE</span><span class="token punctuation">.</span><span class="token function">listCaches</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">list</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//list is an array that you can loop through</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="delete-old-caches"><a href="#delete-old-caches" class="header-anchor">#</a> Delete Old Caches</h3> <p>If you need to delete one or more caches we can use <code>Promise.all()</code> to delete an array of names. This is a less common thing to do. Typically, we do this in a Service Worker when we want to get rid of
old versions of caches.</p> <p>We pass the name (or names) of cache(s) to keep to our function. It will return a Promise that lets us know when it is complete.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token constant">CACHE</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">deleteCache</span><span class="token punctuation">(</span><span class="token parameter">toKeep</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token constant">CACHE</span><span class="token punctuation">.</span><span class="token function">listCaches</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">keys</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">//keys is the array of all the cache names</span>
      <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>keys<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> key <span class="token operator">!=</span> toKeep<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> name<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="get-a-list-of-files-in-a-cache"><a href="#get-a-list-of-files-in-a-cache" class="header-anchor">#</a> Get a List of Files in a Cache</h3> <p>This function could be written in two ways. First, you can pass a reference to the cache that contains the files. Second, you could pass the name of the cache that holds the files</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token constant">CACHE</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">getFileList</span><span class="token punctuation">(</span><span class="token parameter">cache</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//pass in the cache where the files are located</span>
    <span class="token comment">//version 1 - by cache reference</span>
    <span class="token keyword">return</span> cache<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">getFileList</span><span class="token punctuation">(</span><span class="token parameter">cacheName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//if you pass in the name of the cache instead, then you would call CACHE.open() first</span>
    <span class="token comment">//version 2 - by cache name</span>
    <span class="token keyword">return</span> <span class="token constant">CACHE</span><span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">cache</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> cache<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>Back in the main JS file we get an array of all the <code>Request</code> objects from the cache. Each of those Request objects has a <code>url</code> property which can be used to create a <code>URL</code> object. From the <code>URL</code>
object you can extract any part of the url that you want - origin, hostname, pathname, port, protocol, query string, hash, etc.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//main.js</span>
<span class="token keyword">const</span> <span class="token constant">APP</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">cacheRef</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token constant">CACHE</span><span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'my-cache-name'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">cache</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token constant">APP</span><span class="token punctuation">.</span>cacheRef <span class="token operator">=</span> cache<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">getFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token constant">CACHE</span><span class="token punctuation">.</span><span class="token function">getFileList</span><span class="token punctuation">(</span><span class="token constant">APP</span><span class="token punctuation">.</span>cacheRef<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">fileList</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">//fileList is an array of each Request in the Cache</span>
      fileList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>url<span class="token punctuation">.</span>pathname<span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>url<span class="token punctuation">.</span>origin<span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>url<span class="token punctuation">.</span>search<span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>url<span class="token punctuation">.</span>port<span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>url<span class="token punctuation">.</span>hash<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h3 id="delete-a-file-in-a-cache"><a href="#delete-a-file-in-a-cache" class="header-anchor">#</a> Delete a File in a Cache</h3> <p>To delete a file from a cache you need to have the file name or a Request containing the file name, plus a way to reference the cache. To reference the cache you need a cache name or a variable
holding the reference to the cache. For this example we will pass in the reference to the cache.</p> <p>You could alternatively pass in a Request object or URL object instead of a filename.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token constant">CACHE</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">deleteFile</span><span class="token punctuation">(</span><span class="token parameter">filename<span class="token punctuation">,</span> cache</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> cache<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="add-a-file-to-a-cache"><a href="#add-a-file-to-a-cache" class="header-anchor">#</a> Add a File to a Cache</h3> <p>Your function to add a file to a cache could accept a filename, a URL, or a Request object. The best approach is to have a <code>Request</code> object. This way you can define things like the HTTP method,
whether it is <code>cors</code> or <code>no-cors</code> request, and whether or not credentials should be included.</p> <p>The file to be saved needs to be wrapped in a <code>Response</code> object that also gets passed to the CACHE function.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//in main.js</span>
<span class="token keyword">let</span> filename <span class="token operator">=</span> crypto<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'.json'</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Request</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'get'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">credentials</span><span class="token operator">:</span> omit<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">123</span><span class="token punctuation">,</span> <span class="token literal-property property">some</span><span class="token operator">:</span> <span class="token string">'info'</span><span class="token punctuation">,</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'object'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token punctuation">[</span>data<span class="token punctuation">]</span><span class="token punctuation">,</span> filename<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'application/json'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> response <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token literal-property property">statusText</span><span class="token operator">:</span> <span class="token string">'all good'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token constant">CACHE</span><span class="token punctuation">.</span><span class="token function">saveFile</span><span class="token punctuation">(</span><span class="token constant">APP</span><span class="token punctuation">.</span>cacheRef<span class="token punctuation">,</span> request<span class="token punctuation">,</span> response<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//this function runs after the file is saved.</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//handles failure to save file in cache.</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>The third thing that gets passed to the function is a reference to the cache.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//in cache.js</span>
<span class="token keyword">const</span> <span class="token constant">CACHE</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">saveFile</span><span class="token punctuation">(</span><span class="token parameter">cache<span class="token punctuation">,</span> req<span class="token punctuation">,</span> resp</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="get-the-contents-from-any-file"><a href="#get-the-contents-from-any-file" class="header-anchor">#</a> Get the Contents from any File</h3> <p>When a cache saves files, it does so with key value pairs. The Request object is the key and the Response object is the value.</p> <p>The Response object is a container that holds a File. Depending on the type of file there is a different response method that we have to use to get the contents.</p> <p>Whether it is a <code>Response</code> object coming from a <code>Cache</code> or a <code>Response</code> object coming from a <code>fetch</code>, it is still just a <code>Response</code> object.</p> <p>In our cache function we need a filename but we can uses <code>caches</code> instead of a reference to a single cache.</p> <p>In the main Javascript file we will be given a Promise containing the contents of a file OR an Error.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//main.js</span>
<span class="token keyword">let</span> filename <span class="token operator">=</span> <span class="token string">'style.css'</span><span class="token punctuation">;</span>
<span class="token constant">CACHE</span><span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">txt</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//txt is the text from the css file</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//Error about no match</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="get-the-contents-from-a-text-file"><a href="#get-the-contents-from-a-text-file" class="header-anchor">#</a> Get the Contents from a Text File</h3> <p>To get the contents of a text file, which includes <code>.txt</code>, <code>.html</code>, or <code>.css</code>, we use the <code>.text()</code> method.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token constant">CACHE</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">getText</span><span class="token punctuation">(</span><span class="token parameter">filename</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> caches<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">cacheResponse</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">//cacheResponse is the Response object or null</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>cacheResponse<span class="token punctuation">)</span> <span class="token keyword">return</span> cacheResponse<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'No match for text file in the cache'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="get-the-contents-from-a-json-file"><a href="#get-the-contents-from-a-json-file" class="header-anchor">#</a> Get the Contents from a JSON File</h3> <p>To get an Object built from the contents of a <code>.json</code> text file we would use the <code>.json()</code> method on the Response object that is returned by the <code>match()</code> method.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token constant">CACHE</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">getJSON</span><span class="token punctuation">(</span><span class="token parameter">filename</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> caches<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">cacheResponse</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">//cacheResponse is the Response object or null</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>cacheResponse<span class="token punctuation">)</span> <span class="token keyword">return</span> cacheResponse<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'No match for json file in the cache'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="get-the-contents-from-an-image-file"><a href="#get-the-contents-from-an-image-file" class="header-anchor">#</a> Get the Contents from an Image File</h3> <p>When you want an image (or any media file) from a cache we will use the <code>blob()</code> method.</p> <p>The result from the <code>blob()</code> method is actual just a reference to the location in memory where the binary data from inside the image file is saved.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token constant">CACHE</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">getImage</span><span class="token punctuation">(</span><span class="token parameter">filename</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> caches<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">cacheResponse</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">//cacheResponse is the Response object or null</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>cacheResponse<span class="token punctuation">)</span> <span class="token keyword">return</span> cacheResponse<span class="token punctuation">.</span><span class="token function">blob</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'No match for media file in the cache'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>Then back in the main JavaScript file when we receive the blob reference variable, we need to use the <code>URL.createObjectURL()</code> method which will create a URL that points to the location in memory. This
newly created URL can be used as the <code>src</code> for any <code>&lt;img&gt;</code> element.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//main.js</span>
<span class="token keyword">let</span> filename <span class="token operator">=</span> <span class="token string">'myavatar.png'</span><span class="token punctuation">;</span>

<span class="token constant">CACHE</span><span class="token punctuation">.</span><span class="token function">getImage</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">blobRef</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//blobRef is the pointer to the location in memory of the blob</span>
    <span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>blobRef<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> img <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'someImage'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    img<span class="token punctuation">.</span>src <span class="token operator">=</span> url<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//error about no file match in cache</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h2 id="more-data-storage"><a href="#more-data-storage" class="header-anchor">#</a> More Data Storage</h2> <p>When you need to save information for a user in their own browser there are a variety of ways to save that information depending on how much data there is, how it needs to be and how frequently it
needs to be accessed.</p> <p>Ways to save data that can be accessed again later via JavaScript:</p> <ul><li>Cookies [see module 2.1]</li> <li>WebStorage (LocalStorage and SessionStorage) [see module 2.1]</li> <li>Cache API [see module 2.2]</li> <li>IndexedDB [see module 3.1]</li> <li>Browser Cache can save files but cannot be accessed via JavaScript [see module 2.1]</li> <li>Generated files, that the user can save and then re-upload at a later time.</li></ul> <h2 id="indexeddb"><a href="#indexeddb" class="header-anchor">#</a> IndexedDB</h2> <p>The notes here will give a brief introduction to how <code>IndexedDB</code> works. If you want a greater understanding of how to use <code>IndexedDB</code> as part of a project then you should watch
<a href="https://www.youtube.com/watch?v=6fK1K28eoUA&amp;list=PLyuRouwmQCjmNyAysdqjNz5fIS5cYU4vi" target="_blank" rel="noopener noreferrer">this playlist<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p><code>IndexedDB</code> is a type of document database that you can create in the browser.</p> <p>It has methods for opening and creating a new database and then creating collections. Then methods for adding new objects, updating objects, and deleting objects. Additionally, you can search through
a collection for specific objects based on the values of different properties. Each of these tasks is called a <code>request</code>. And, just like an HTTP request, you won't know how long it will take. However,
they don't use Promises, they use events.</p> <p>The way you can know when your <code>IndexedDB</code> requests are finished running is with event listeners.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> db <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> dbOpenRequest <span class="token operator">=</span> indexedDB<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'DBName'</span><span class="token punctuation">,</span> version<span class="token punctuation">)</span><span class="token punctuation">;</span>
dbOpenRequest<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//database failed to open</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
dbOpenRequest<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'success'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//database has opened successfully</span>
  db <span class="token operator">=</span> ev<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
dbOpenRequest<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'upgradeneeded'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//the db version has changed</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>When you need to run several requests in a row, as part of a bigger process, then you should use a transaction object to wrap each of the calls to the database.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//db is a reference to the opened IndexedDB</span>
<span class="token keyword">let</span> tx <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token string">'storeName'</span><span class="token punctuation">,</span> <span class="token string">'readwrite'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
tx<span class="token punctuation">.</span><span class="token function-variable function">oncomplete</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//when the transaction is complete</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
tx<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//something in the transaction failed</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>Once you have a transaction then you can point it at a specific object collection from your <code>IndexedDB</code> and then run whatever command(s) you want.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> store <span class="token operator">=</span> tx<span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span><span class="token string">'storeName'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> getRequest <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Each request that you make inside the transaction has a <code>success</code> event and an <code>error</code> event.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>getRequest<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> request <span class="token operator">=</span> ev<span class="token punctuation">.</span>target<span class="token punctuation">;</span> <span class="token comment">//the getRequest</span>
  <span class="token keyword">let</span> result <span class="token operator">=</span> request<span class="token punctuation">.</span>result<span class="token punctuation">;</span> <span class="token comment">//the result of the getAll() call</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
getRequest<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//this request failed</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>You can make as many requests as you want inside the transaction. Each request has its own success and error event and the transaction has a success and error event too.</p> <p>If you want, you can wrap your transaction and requests in functions and make those functions use Promises. That way you can chain together all your database requests.</p> <div class="custom-block tip"><p class="custom-block-title">Wrapping Event Listeners with Promises</p> <p>Here is a tutorial about <a href="https://dev.to/prof3ssorst3v3/you-can-convert-your-callbacks-to-promises-141n" target="_blank" rel="noopener noreferrer">wrapping event listeners with Promises<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p></div> <h2 id="manipulating-data"><a href="#manipulating-data" class="header-anchor">#</a> Manipulating Data</h2> <p>When you create objects in JavaScript they can be hard-coded, they can be from an API, or they can be from user created data. Whatever the source, you will often need to manipulate, edit, or rearrange
that information.</p> <p>Maybe you fetch data from an API and it returns an object like this:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">created_at</span><span class="token operator">:</span> <span class="token number">1701231234320</span><span class="token punctuation">,</span>
  <span class="token literal-property property">results</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">92837492387</span><span class="token punctuation">,</span>
      <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'AI is learning from you'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">isbn</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">'isbn-10'</span><span class="token operator">:</span> <span class="token number">1234567890</span><span class="token punctuation">,</span>
        <span class="token string-property property">'isbn-13'</span><span class="token operator">:</span> <span class="token number">1234567890123</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">authors</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span><span class="token literal-property property">id</span><span class="token operator">:</span><span class="token number">23746</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">'Yann LeCun'</span><span class="token punctuation">,</span> <span class="token literal-property property">email</span><span class="token operator">:</span> <span class="token string">'yann@meta.org'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token literal-property property">id</span><span class="token operator">:</span><span class="token number">3453</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">'Tristan Harris'</span><span class="token punctuation">,</span> <span class="token literal-property property">email</span><span class="token operator">:</span> <span class="token string">'tristan@socialdilema.org'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token literal-property property">id</span><span class="token operator">:</span><span class="token number">23746</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">'Sebastien Bubeck'</span><span class="token punctuation">,</span> <span class="token literal-property property">email</span><span class="token operator">:</span> <span class="token string">'sebastien@ms.org'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token literal-property property">numbers</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token literal-property property">small</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">medium</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1234</span><span class="token punctuation">,</span> <span class="token number">3456</span><span class="token punctuation">,</span> <span class="token number">6775</span><span class="token punctuation">,</span> <span class="token number">86877</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">large</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1709812367228000</span><span class="token punctuation">,</span> <span class="token number">15098234876234000</span><span class="token punctuation">,</span> <span class="token number">4200003876</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token literal-property property">publisher</span><span class="token operator">:</span> <span class="token string">'Sample publishing house'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">pages</span><span class="token operator">:</span> <span class="token number">1234</span><span class="token punctuation">,</span>
      <span class="token literal-property property">other</span><span class="token operator">:</span> <span class="token string">'more properties...'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>So, there is a lot of information here. There are many properties here and in the <code>results</code> array there is only one object. What if there were 1000 objects inside the <code>results</code> array? What if the only
things you wanted from this data were the <code>title</code> and author <code>name</code> values from each object inside each object inside of <code>results</code>?</p> <p>This is the type of data manipulation that you need to understand and need to be comfortable using regularly. We want to be able to remove objects that lack the properties we need. We want to discard
properties that we don't need from each object. We might want to only keep the contents of the object array.</p> <h3 id="basic-object-manipulation"><a href="#basic-object-manipulation" class="header-anchor">#</a> Basic Object Manipulation</h3> <p>So, here are some common tasks for manipulating JavaScript Objects.</p> <p><strong>checking for property existence</strong></p> <p>If you want to check if a property exists in an Object or anywhere in it's prototype chain, then we can use the <code>in</code> operator as part of an <code>if</code> statement or <code>ternary</code> statement.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">'someProp'</span> <span class="token keyword">in</span> myObj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">'map'</span> <span class="token keyword">in</span> myArray<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">'length'</span> <span class="token keyword">in</span> myStr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> doesExist <span class="token operator">=</span> <span class="token string">'someProp'</span> <span class="token keyword">in</span> myObj <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>If you need to know whether an Object has a property connected directly to itself, and not just somewhere on the prototype chain, then you should use the static Object method <code>hasOwn</code>.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> myObj <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">someProp</span><span class="token operator">:</span> <span class="token number">123</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> myArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">hasOwn</span><span class="token punctuation">(</span>Object<span class="token punctuation">,</span> <span class="token string">'toString'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//false</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">hasOwn</span><span class="token punctuation">(</span>myObj<span class="token punctuation">,</span> <span class="token string">'toString'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//false</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">hasOwn</span><span class="token punctuation">(</span>myArr<span class="token punctuation">,</span> <span class="token string">'toString'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//false</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">hasOwn</span><span class="token punctuation">(</span>myObj<span class="token punctuation">,</span> <span class="token string">'someProp'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>adding properties</strong></p> <p>Adding a property to a JavaScript object is the same as editing a property. If the property exists then the new value will replace the old one. If the property does not exist yet, it will be created.
You can use either dot notation or the square bracket syntax.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>myObj<span class="token punctuation">.</span>someProp <span class="token operator">=</span> <span class="token string">'new value'</span><span class="token punctuation">;</span>
myObj<span class="token punctuation">[</span><span class="token string">'someProp'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'another new value'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>removing properties</strong></p> <p>You can assign <code>null</code> or <code>undefined</code> directly to a property. However, this does not remove the property. If you actually want to remove the property then you need to use the <code>delete</code> keyword.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">delete</span> myObj<span class="token punctuation">.</span>someProp<span class="token punctuation">;</span>
<span class="token keyword">delete</span> myObj<span class="token punctuation">.</span>anotherProp<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="accessing-properties"><a href="#accessing-properties" class="header-anchor">#</a> Accessing Properties</h3> <p>When you want to access the properties of an Object then we can use dot notation or square brackets. For an Array we need to use square brackets with integer indexes. You can drill down through each
level by using chains of those.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//the isbn-13 number from the first object in the results array</span>
data<span class="token punctuation">.</span>results<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>isbn<span class="token punctuation">[</span><span class="token string">'isbn-13'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
data<span class="token punctuation">[</span><span class="token string">'results'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'isbn'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'isbn-13'</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//alternate version of previous line</span>

<span class="token comment">//the last authors name from the first object in the results array</span>
data<span class="token punctuation">.</span>results<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>authors<span class="token punctuation">[</span>data<span class="token punctuation">.</span>results<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>authors<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="iterable-manipulation"><a href="#iterable-manipulation" class="header-anchor">#</a> Iterable Manipulation</h3> <p>JavaScript has a protocol called <code>iterable</code>. It is not an actual object type but more a set of rules that object types need to follow. An Array is a type of object that follows the iterable protocol.
In some languages, Iterable is actually a type of object. You can say &quot;iterable object&quot; and other developers will understand what you mean.</p> <div title="iterable vs enumerable" class="video-player"><iframe width="560" height="315" src="https://www.youtube.com/embed/HZjvoftRvGE" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; fullscreen" allowfullscreen="allowfullscreen"></iframe></div> <div title="testing if an object is iterable" class="video-player"><iframe width="560" height="315" src="https://www.youtube.com/embed/-PBI4LxiG8Y" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; fullscreen" allowfullscreen="allowfullscreen"></iframe></div> <p>The iterable object that you get from an API will always be an Array. At least until the new <code>Tuple</code> data type becomes an official part of the ECMA standard.
<a href="https://github.com/tc39/proposal-record-tuple" target="_blank" rel="noopener noreferrer">Read about the Records and Tuples proposal<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>Arrays also have a new <code>at</code> method which is an alternative to the square brackets and index number for accessing an array value.</p> <p>When you manipulate data held in Arrays, you will usually be doing so with the <code>map</code>, <code>filter</code>, <code>reduce</code>, or <code>flatmap</code> methods. These methods all return a new array</p> <p>As a demonstration of the problem described above - removing objects from the results array that are missing a property, and removing the properties other than title and author names - this script
does these things.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//let data = { results: [{}, {}]... }</span>
<span class="token keyword">let</span> resultsData <span class="token operator">=</span> data<span class="token punctuation">.</span>results
  <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//running the filter first to remove objects we don't want to keep</span>
    <span class="token keyword">return</span> Object<span class="token punctuation">.</span><span class="token function">hasOwn</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> <span class="token string">'title'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> Object<span class="token punctuation">.</span><span class="token function">hasOwn</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> <span class="token string">'authors'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>authors<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//only keep objects that have both a title and authors prop and authors is an array</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//create new objects that only have a title property and a copy of the authors array</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span> title<span class="token punctuation">,</span> <span class="token literal-property property">authors</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">...</span>item<span class="token punctuation">.</span>authors<span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><div title="New Array at method" class="video-player"><iframe width="560" height="315" src="https://www.youtube.com/embed/gBu1CWBPdZ8" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; fullscreen" allowfullscreen="allowfullscreen"></iframe></div> <div title="Array Map" class="video-player"><iframe width="560" height="315" src="https://www.youtube.com/embed/hfYa4ugeyuc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; fullscreen" allowfullscreen="allowfullscreen"></iframe></div> <div title="Array Filter" class="video-player"><iframe width="560" height="315" src="https://www.youtube.com/embed/WrB_--bVbbs" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; fullscreen" allowfullscreen="allowfullscreen"></iframe></div> <div title="Array Reduce" class="video-player"><iframe width="560" height="315" src="https://www.youtube.com/embed/6_XzV25rkcE" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; fullscreen" allowfullscreen="allowfullscreen"></iframe></div> <div title="Array Flatmap" class="video-player"><iframe width="560" height="315" src="https://www.youtube.com/embed/pA07-XJ3dBk" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; fullscreen" allowfullscreen="allowfullscreen"></iframe></div> <h2 id="modules-namespaces-and-organizing-code"><a href="#modules-namespaces-and-organizing-code" class="header-anchor">#</a> Modules, Namespaces, and Organizing Code</h2> <p>When you start building websites, they tend to be rather simple and will use only one JavaScript file. As functionality grows and the amount of code required for your web app grows, so does the
importance of organizing your code in a way that is easy to manage and maintain.</p> <p>Additionally, as part of the organization of our code, we need to avoid naming conflicts between our objects and methods, and the ones that we add to our website from external sources and libraries.</p> <p>The first simple approach to avoiding naming conflicts is through namespacing objects. In namespacing we simply wrap a collection of variables and functions as properties inside an Object literal.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token constant">APP</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">apikey</span><span class="token operator">:</span> <span class="token string">'unique-string-for-api-calls'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">baseurl</span><span class="token operator">:</span> <span class="token string">'https://example.com/api/v2'</span><span class="token punctuation">,</span>
  <span class="token function-variable function">init</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//function that gets called when the page loads</span>
    <span class="token constant">APP</span><span class="token punctuation">.</span><span class="token function">addListeners</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token constant">APP</span><span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">getData</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//function to make a fetch call</span>
    <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token constant">APP</span><span class="token punctuation">.</span>baseurl<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">apikey</span><span class="token operator">:</span> <span class="token constant">APP</span><span class="token punctuation">.</span>apikey<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">addListeners</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//add all the event listeners for the page</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">//when the page loads call the APP.init method</span>
document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'DOMContentLoaded'</span><span class="token punctuation">,</span> <span class="token constant">APP</span><span class="token punctuation">.</span>init<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>We can capitalize the name of the namespace as a convention to make it easier to spot in the code. To use the namespace, all you need to do is prefix any of the properties or methods with the name of
the namespace.</p> <p>Before the addition of ES Modules support to the browsers developers would just create a different file for each namespace and then load them all via script tags in the HTML. Every script would get
loaded into the global scope. The namespaces will prevent conflicts between any function or value as long as each of the namespaces have their own unique name.</p> <p>Now, we also have ES Modules. So, we create the same separate files as we do with the namespaces. We can keep the namespace object or return everything back to individual variables and functions.</p> <p>Each file needs to be loaded as a <code>module</code>. To do that we just add the <code>type=&quot;module&quot;</code> attribute to the first <code>&lt;script&gt;</code> tag to be loaded by the webpage.</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./js/main.js<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>As soon as one script is loaded as a <code>module</code> then it will be able to use the <code>import</code> command. Any script loaded via an <code>import</code> command will automatically be a <code>module</code>. In the module script, any
variable or function that you want to be allowed to be imported, will have to be marked with the <code>export</code> keyword.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//./js/somecode.js</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//the main function for this module</span>
  <span class="token function">third</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//calling a private function from this module</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">second</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//some other exportable function</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">third</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//a private function inside this module</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> abc <span class="token operator">=</span> <span class="token number">123</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> def <span class="token operator">=</span> <span class="token string">'hello'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token punctuation">{</span> second<span class="token punctuation">,</span> abc<span class="token punctuation">,</span> def <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//./js/main.js</span>
<span class="token keyword">import</span> start<span class="token punctuation">,</span> <span class="token punctuation">{</span> second<span class="token punctuation">,</span> abc<span class="token punctuation">,</span> def <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./somecode.js'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//the function from the other file called first()</span>
  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> second<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//function from the other file</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>abc<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>def<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'DOMContentLoaded'</span><span class="token punctuation">,</span> init<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><div title="import and export of es modules" class="video-player"><iframe width="560" height="315" src="https://www.youtube.com/embed/jwcD9n3RqWQ" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; fullscreen" allowfullscreen="allowfullscreen"></iframe></div> <div title="dynamic imports of es modules" class="video-player"><iframe width="560" height="315" src="https://www.youtube.com/embed/IhWpL0g3QME" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; fullscreen" allowfullscreen="allowfullscreen"></iframe></div> <h2 id="todo-this-week"><a href="#todo-this-week" class="header-anchor">#</a> ToDo This Week</h2> <div class="custom-block danger"><p class="custom-block-title">To Do this week</p> <ul><li>read all the content for modules 3.1 and 3.2</li> <li>read all the content for Hybrid <a href="/s2024/modules/hybrids/">web component creation</a></li> <li>review Hybrid <a href="/s2024/modules/hybrids/exercises.html">Web Component exercise 2</a></li> <li>complete the <a href="/s2024/assignments/assign/">Cache API exercise</a></li></ul></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">5/2/2024, 3:31:33 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/s2024/modules/pwas/week2/2.2/" class="prev">
        2.2: Cache, Files &amp; Responses
      </a></span> <span class="next"><a href="/s2024/modules/pwas/week3/3.2/">
        3.2: Intro to Workers
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/s2024/assets/js/app.800de6cb.js" defer></script><script src="/s2024/assets/js/2.65264708.js" defer></script><script src="/s2024/assets/js/35.e656cbcf.js" defer></script><script src="/s2024/assets/js/9.005e1e8c.js" defer></script><script src="/s2024/assets/js/11.87711128.js" defer></script>
  </body>
</html>
