<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>6.1 PWA Concept Review | MAD9022</title>
    <meta name="generator" content="VuePress 1.9.8">
    
    <meta name="description" content="Fullstack: Frontend Development Course">
    
    <link rel="preload" href="/s2024/assets/css/0.styles.0189e570.css" as="style"><link rel="preload" href="/s2024/assets/js/app.800de6cb.js" as="script"><link rel="preload" href="/s2024/assets/js/2.65264708.js" as="script"><link rel="preload" href="/s2024/assets/js/39.28fe2c35.js" as="script"><link rel="preload" href="/s2024/assets/js/9.005e1e8c.js" as="script"><link rel="prefetch" href="/s2024/assets/js/10.912d3f44.js"><link rel="prefetch" href="/s2024/assets/js/11.87711128.js"><link rel="prefetch" href="/s2024/assets/js/12.1ad3b3b9.js"><link rel="prefetch" href="/s2024/assets/js/13.5c6eca3c.js"><link rel="prefetch" href="/s2024/assets/js/14.a39ca56d.js"><link rel="prefetch" href="/s2024/assets/js/15.fea1e72e.js"><link rel="prefetch" href="/s2024/assets/js/16.6b8223ef.js"><link rel="prefetch" href="/s2024/assets/js/17.db7cf2f4.js"><link rel="prefetch" href="/s2024/assets/js/18.7759db48.js"><link rel="prefetch" href="/s2024/assets/js/19.bb0f2052.js"><link rel="prefetch" href="/s2024/assets/js/20.3f3d5c16.js"><link rel="prefetch" href="/s2024/assets/js/21.23f944a3.js"><link rel="prefetch" href="/s2024/assets/js/22.32b2777d.js"><link rel="prefetch" href="/s2024/assets/js/23.aa560bd2.js"><link rel="prefetch" href="/s2024/assets/js/24.1160513f.js"><link rel="prefetch" href="/s2024/assets/js/25.257a77d2.js"><link rel="prefetch" href="/s2024/assets/js/26.9c34cefb.js"><link rel="prefetch" href="/s2024/assets/js/27.b2ff0a06.js"><link rel="prefetch" href="/s2024/assets/js/28.d09f9311.js"><link rel="prefetch" href="/s2024/assets/js/29.a0941762.js"><link rel="prefetch" href="/s2024/assets/js/3.544714c7.js"><link rel="prefetch" href="/s2024/assets/js/30.47ebd370.js"><link rel="prefetch" href="/s2024/assets/js/31.ece81fbc.js"><link rel="prefetch" href="/s2024/assets/js/32.ae206ed9.js"><link rel="prefetch" href="/s2024/assets/js/33.9514a6a6.js"><link rel="prefetch" href="/s2024/assets/js/34.583d401c.js"><link rel="prefetch" href="/s2024/assets/js/35.e656cbcf.js"><link rel="prefetch" href="/s2024/assets/js/36.cacc60df.js"><link rel="prefetch" href="/s2024/assets/js/37.1d4e63ca.js"><link rel="prefetch" href="/s2024/assets/js/38.4711b180.js"><link rel="prefetch" href="/s2024/assets/js/4.a59aad47.js"><link rel="prefetch" href="/s2024/assets/js/40.7a728e12.js"><link rel="prefetch" href="/s2024/assets/js/41.102054ba.js"><link rel="prefetch" href="/s2024/assets/js/42.e4927ef8.js"><link rel="prefetch" href="/s2024/assets/js/43.991ea947.js"><link rel="prefetch" href="/s2024/assets/js/44.8db11b89.js"><link rel="prefetch" href="/s2024/assets/js/45.8da8f59f.js"><link rel="prefetch" href="/s2024/assets/js/46.e4ae4586.js"><link rel="prefetch" href="/s2024/assets/js/47.3a64f81f.js"><link rel="prefetch" href="/s2024/assets/js/48.85a59034.js"><link rel="prefetch" href="/s2024/assets/js/49.d9dd3379.js"><link rel="prefetch" href="/s2024/assets/js/5.6426ebe4.js"><link rel="prefetch" href="/s2024/assets/js/50.51e2c9f2.js"><link rel="prefetch" href="/s2024/assets/js/51.bcc581ae.js"><link rel="prefetch" href="/s2024/assets/js/52.42daf800.js"><link rel="prefetch" href="/s2024/assets/js/6.2beeeb0e.js"><link rel="prefetch" href="/s2024/assets/js/7.64cbf74e.js"><link rel="prefetch" href="/s2024/assets/js/8.e15ce9b2.js">
    <link rel="stylesheet" href="/s2024/assets/css/0.styles.0189e570.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/s2024/" class="home-link router-link-active"><img src="/s2024/mad-d-logo-sm.png" alt="MAD9022" class="logo"> <span class="site-name can-hide">MAD9022</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/s2024/overview/" class="nav-link">
  Overview
</a></div><div class="nav-item"><a href="/s2024/assignments/" class="nav-link">
  Deliverables
</a></div><div class="nav-item"><a href="/s2024/resources/" class="nav-link">
  Resources
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/s2024/overview/" class="nav-link">
  Overview
</a></div><div class="nav-item"><a href="/s2024/assignments/" class="nav-link">
  Deliverables
</a></div><div class="nav-item"><a href="/s2024/resources/" class="nav-link">
  Resources
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Hybrid</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>PWA</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/s2024/modules/pwas/week1/1.1/" class="sidebar-link">1.1: Promises &amp; Fetch</a></li><li><a href="/s2024/modules/pwas/week1/1.2/" class="sidebar-link">1.2: Git &amp; Pull Requests</a></li><li><a href="/s2024/modules/pwas/week2/2.1/" class="sidebar-link">2.1: Web Storage, Cookies, &amp; Cache</a></li><li><a href="/s2024/modules/pwas/week2/2.2/" class="sidebar-link">2.2: Cache, Files &amp; Responses</a></li><li><a href="/s2024/modules/pwas/week3/3.1/" class="sidebar-link">3.1: Storage &amp; Data Manipulation</a></li><li><a href="/s2024/modules/pwas/week3/3.2/" class="sidebar-link">3.2: Intro to Workers</a></li><li><a href="/s2024/modules/pwas/week4/4.1/" class="sidebar-link">4.1: Service Workers</a></li><li><a href="/s2024/modules/pwas/week4/4.2/" class="sidebar-link">4.2: Messaging &amp; Screen APIs</a></li><li><a href="/s2024/modules/pwas/week5/5.1/" class="sidebar-link">5.1: Intro to PWA</a></li><li><a href="/s2024/modules/pwas/week5/5.2/" class="sidebar-link">5.2: Audits, Offline Status, &amp; Service Worker Methods</a></li><li><a href="/s2024/modules/pwas/week6/6.1/" aria-current="page" class="active sidebar-link">6.1: PWA Concept Review</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/s2024/modules/pwas/week6/6.1/#filtering-cache-matches" class="sidebar-link">Filtering Cache Matches</a></li><li class="sidebar-sub-header"><a href="/s2024/modules/pwas/week6/6.1/#pwa-project" class="sidebar-link">PWA Project</a></li><li class="sidebar-sub-header"><a href="/s2024/modules/pwas/week6/6.1/#tips" class="sidebar-link">Tips</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/s2024/modules/pwas/week6/6.1/#generating-ids" class="sidebar-link">Generating Ids</a></li><li class="sidebar-sub-header"><a href="/s2024/modules/pwas/week6/6.1/#filenames" class="sidebar-link">Filenames</a></li></ul></li><li class="sidebar-sub-header"><a href="/s2024/modules/pwas/week6/6.1/#todo-this-week" class="sidebar-link">ToDo This Week</a></li></ul></li><li><a href="/s2024/modules/pwas/week6/6.2/" class="sidebar-link">6.2: Web App Hosting</a></li><li><a href="/s2024/modules/pwas/week7/7.1/" class="sidebar-link">7.1: PWA Project</a></li><li><a href="/s2024/modules/pwas/week7/7.2/" class="sidebar-link">7.2: PWA Project</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>React</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><header><div class="section-title red">
    PWA
  </div> <h1>6.1 PWA Concept Review</h1> <div class="underdev no">Module Still Under Development</div></header> <h2 id="filtering-cache-matches"><a href="#filtering-cache-matches" class="header-anchor">#</a> Filtering Cache Matches</h2> <p>By default, when you save an HTTP Response with the Cache API, if the querystring is different then it will be a separate entry in the Cache. For example, these four urls:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>http://localhost:3000/index.html?name=steve
http://localhost:3000/index.html?name=tony
http://localhost:3000/index.html?name=adesh
http://localhost:3000/index.html?name=gerry
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>will each be saved as a different entry.</p> <p>So, when you want to find a match, you may need to consider or ignore the querystring portion. The cache <code>match</code> and <code>matchAll</code> methods include a options object, that let you modify the search</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>caches<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'mycache'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">cache</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> req <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Request</span><span class="token punctuation">(</span><span class="token string">'http://localhost:3000/index.html?name=tony'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//find the first match regardless of querystring value</span>
  cache<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">ignoreSearch</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//one match or null</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//find the first match that includes the correct querystring</span>
  cache<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">ignoreSearch</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//one match or null</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//find ALL the matches ignoring the querystring</span>
  cache<span class="token punctuation">.</span><span class="token function">matchAll</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">ignoreSearch</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">responses</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//array of all matches</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>The other side of this is the saving process. When you are saving items in the cache maybe you want to strip off the querystring because you don't want to end up with dozens of copies of the same page
in your cache.</p> <p>Say for example the user visits the product's page on the website three times. Each time is to get the details of a different product.</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>http://localhost:3000/products?product_id=123456
http://localhost:3000/products?product_id=765432
http://localhost:3000/products?product_id=999999
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>Now, let's assume that the HTML that loads in the page is always the same. After the page loads, a fetch call is made using the product id from the querystring. The fetch call loads the data and
updates the display. Since the original HTML is the same every time and there are potentially thousands of product ids, why would you want to save every copy of the file in the cache, just because the
querystring changes.</p> <p>So, in your service worker, you need to check for the value of the pathname of the URL and create a new URL without the querystring to use as the key for the response.</p> <p>The following example uses the cacheFirst caching strategy</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'fetch'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>ev<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>url<span class="token punctuation">.</span>pathname <span class="token operator">==</span> <span class="token string">'/products'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//request for the /products page</span>
    ev<span class="token punctuation">.</span><span class="token function">respondWith</span><span class="token punctuation">(</span>
      caches<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'mycache'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">cache</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
          cache<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>ev<span class="token punctuation">.</span>request<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">ignoreSearch</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">||</span>
          <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">fetchResponse</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> copy <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//remove the querystring</span>
            url<span class="token punctuation">.</span>searchParams <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URLSearchParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//save in the cache with emptied querystring</span>
            cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> copy<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//return the fetched file</span>
            <span class="token keyword">return</span> fetchResponse<span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">//all other requests... just pass through</span>
    ev<span class="token punctuation">.</span><span class="token function">respondWith</span><span class="token punctuation">(</span><span class="token function">fetch</span><span class="token punctuation">(</span>ev<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>So, now if the user visits the <code>/products</code> page, we check the cache first. If the file is there (ignoring the querystring value of the request), then return the cached file.</p> <p>If the file is not in the cache, then fetch the file, create a clone copy of the response and save it in the cache using the same URL but without the querystring. The original file response gets sent
back to the browser.</p> <h2 id="pwa-project"><a href="#pwa-project" class="header-anchor">#</a> PWA Project</h2> <p>To build a PWA there are a number of things that we to include.</p> <ol><li>A <code>manifest.json</code> file that defines all the settings, base colours, and icons for the App which can be used when installed.</li> <li>The icons outlined in the <code>manifest.json</code> file.</li> <li>CSS to create a responsive design for the app.</li> <li>A service worker that handles all the HTTP Requests made by the web page.</li> <li>Cache that holds copies of files to be used when the App is offline.</li> <li>A 404 type page is stored in the Cache, which you can display if a link to a web page is clicked and that link is not in your cache.</li></ol> <h2 id="tips"><a href="#tips" class="header-anchor">#</a> Tips</h2> <h3 id="generating-ids"><a href="#generating-ids" class="header-anchor">#</a> Generating Ids</h3> <p>When you need to generate a new id for an person, an idea, or a file, you can use the built-in JavaScript <code>crypto.randomUUID()</code> method. Using <code>Date.now()</code> is an alternative approach that will create a
unique value to use as an id.</p> <h3 id="filenames"><a href="#filenames" class="header-anchor">#</a> Filenames</h3> <p>When you create file names, remember that every file needs a unique name. The filename that is used in the Cache will be the same name that is used for the Export.</p> <p>The <code>crypto.randomUUID()</code> or <code>Date.now()</code> are both good ways to create a unique value to use as part of the filename.</p> <h2 id="todo-this-week"><a href="#todo-this-week" class="header-anchor">#</a> ToDo This Week</h2> <div class="custom-block danger"><p class="custom-block-title">To Do this week</p> <ul><li>read all the content for modules 6.1 and 6.2</li> <li>Read through the details of the <a href="/s2024/assignments/projects/">PWA Project</a>.</li> <li>Finish your Hybrid Web Component <a href="/s2024/modules/hybrids/exercises.html">exercise</a></li></ul></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">5/8/2024, 9:38:30 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/s2024/modules/pwas/week5/5.2/" class="prev">
        5.2: Audits, Offline Status, &amp; Service Worker Methods
      </a></span> <span class="next"><a href="/s2024/modules/pwas/week6/6.2/">
        6.2: Web App Hosting
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/s2024/assets/js/app.800de6cb.js" defer></script><script src="/s2024/assets/js/2.65264708.js" defer></script><script src="/s2024/assets/js/39.28fe2c35.js" defer></script><script src="/s2024/assets/js/9.005e1e8c.js" defer></script>
  </body>
</html>
