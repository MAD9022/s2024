<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>2.1 Web Storage, Cookies, &amp; Cache | MAD9022</title>
    <meta name="generator" content="VuePress 1.9.8">
    
    <meta name="description" content="Fullstack: Frontend Development Course">
    
    <link rel="preload" href="/s2024/assets/css/0.styles.0189e570.css" as="style"><link rel="preload" href="/s2024/assets/js/app.800de6cb.js" as="script"><link rel="preload" href="/s2024/assets/js/2.65264708.js" as="script"><link rel="preload" href="/s2024/assets/js/33.9514a6a6.js" as="script"><link rel="preload" href="/s2024/assets/js/9.005e1e8c.js" as="script"><link rel="preload" href="/s2024/assets/js/11.87711128.js" as="script"><link rel="prefetch" href="/s2024/assets/js/10.912d3f44.js"><link rel="prefetch" href="/s2024/assets/js/12.1ad3b3b9.js"><link rel="prefetch" href="/s2024/assets/js/13.5c6eca3c.js"><link rel="prefetch" href="/s2024/assets/js/14.a39ca56d.js"><link rel="prefetch" href="/s2024/assets/js/15.fea1e72e.js"><link rel="prefetch" href="/s2024/assets/js/16.6b8223ef.js"><link rel="prefetch" href="/s2024/assets/js/17.db7cf2f4.js"><link rel="prefetch" href="/s2024/assets/js/18.7759db48.js"><link rel="prefetch" href="/s2024/assets/js/19.bb0f2052.js"><link rel="prefetch" href="/s2024/assets/js/20.3f3d5c16.js"><link rel="prefetch" href="/s2024/assets/js/21.23f944a3.js"><link rel="prefetch" href="/s2024/assets/js/22.32b2777d.js"><link rel="prefetch" href="/s2024/assets/js/23.aa560bd2.js"><link rel="prefetch" href="/s2024/assets/js/24.1160513f.js"><link rel="prefetch" href="/s2024/assets/js/25.257a77d2.js"><link rel="prefetch" href="/s2024/assets/js/26.9c34cefb.js"><link rel="prefetch" href="/s2024/assets/js/27.b2ff0a06.js"><link rel="prefetch" href="/s2024/assets/js/28.d09f9311.js"><link rel="prefetch" href="/s2024/assets/js/29.a0941762.js"><link rel="prefetch" href="/s2024/assets/js/3.544714c7.js"><link rel="prefetch" href="/s2024/assets/js/30.47ebd370.js"><link rel="prefetch" href="/s2024/assets/js/31.ece81fbc.js"><link rel="prefetch" href="/s2024/assets/js/32.ae206ed9.js"><link rel="prefetch" href="/s2024/assets/js/34.583d401c.js"><link rel="prefetch" href="/s2024/assets/js/35.e656cbcf.js"><link rel="prefetch" href="/s2024/assets/js/36.cacc60df.js"><link rel="prefetch" href="/s2024/assets/js/37.1d4e63ca.js"><link rel="prefetch" href="/s2024/assets/js/38.4711b180.js"><link rel="prefetch" href="/s2024/assets/js/39.28fe2c35.js"><link rel="prefetch" href="/s2024/assets/js/4.a59aad47.js"><link rel="prefetch" href="/s2024/assets/js/40.7a728e12.js"><link rel="prefetch" href="/s2024/assets/js/41.102054ba.js"><link rel="prefetch" href="/s2024/assets/js/42.e4927ef8.js"><link rel="prefetch" href="/s2024/assets/js/43.991ea947.js"><link rel="prefetch" href="/s2024/assets/js/44.8db11b89.js"><link rel="prefetch" href="/s2024/assets/js/45.8da8f59f.js"><link rel="prefetch" href="/s2024/assets/js/46.e4ae4586.js"><link rel="prefetch" href="/s2024/assets/js/47.3a64f81f.js"><link rel="prefetch" href="/s2024/assets/js/48.85a59034.js"><link rel="prefetch" href="/s2024/assets/js/49.d9dd3379.js"><link rel="prefetch" href="/s2024/assets/js/5.6426ebe4.js"><link rel="prefetch" href="/s2024/assets/js/50.51e2c9f2.js"><link rel="prefetch" href="/s2024/assets/js/51.bcc581ae.js"><link rel="prefetch" href="/s2024/assets/js/52.42daf800.js"><link rel="prefetch" href="/s2024/assets/js/6.2beeeb0e.js"><link rel="prefetch" href="/s2024/assets/js/7.64cbf74e.js"><link rel="prefetch" href="/s2024/assets/js/8.e15ce9b2.js">
    <link rel="stylesheet" href="/s2024/assets/css/0.styles.0189e570.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/s2024/" class="home-link router-link-active"><img src="/s2024/mad-d-logo-sm.png" alt="MAD9022" class="logo"> <span class="site-name can-hide">MAD9022</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/s2024/overview/" class="nav-link">
  Overview
</a></div><div class="nav-item"><a href="/s2024/assignments/" class="nav-link">
  Deliverables
</a></div><div class="nav-item"><a href="/s2024/resources/" class="nav-link">
  Resources
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/s2024/overview/" class="nav-link">
  Overview
</a></div><div class="nav-item"><a href="/s2024/assignments/" class="nav-link">
  Deliverables
</a></div><div class="nav-item"><a href="/s2024/resources/" class="nav-link">
  Resources
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Hybrid</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>PWA</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/s2024/modules/pwas/week1/1.1/" class="sidebar-link">1.1: Promises &amp; Fetch</a></li><li><a href="/s2024/modules/pwas/week1/1.2/" class="sidebar-link">1.2: Git &amp; Pull Requests</a></li><li><a href="/s2024/modules/pwas/week2/2.1/" aria-current="page" class="active sidebar-link">2.1: Web Storage, Cookies, &amp; Cache</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/s2024/modules/pwas/week2/2.1/#client-side-storage" class="sidebar-link">Client-Side Storage</a></li><li class="sidebar-sub-header"><a href="/s2024/modules/pwas/week2/2.1/#cookies" class="sidebar-link">Cookies</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/s2024/modules/pwas/week2/2.1/#cookie-settings" class="sidebar-link">Cookie Settings</a></li><li class="sidebar-sub-header"><a href="/s2024/modules/pwas/week2/2.1/#cookie-methods" class="sidebar-link">Cookie Methods</a></li></ul></li><li class="sidebar-sub-header"><a href="/s2024/modules/pwas/week2/2.1/#passing-data-between-pages" class="sidebar-link">Passing Data between Pages</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/s2024/modules/pwas/week2/2.1/#in-the-querystring" class="sidebar-link">In the QueryString</a></li><li class="sidebar-sub-header"><a href="/s2024/modules/pwas/week2/2.1/#in-a-cookie" class="sidebar-link">In a Cookie</a></li><li class="sidebar-sub-header"><a href="/s2024/modules/pwas/week2/2.1/#storage-apis" class="sidebar-link">Storage APIs</a></li></ul></li><li class="sidebar-sub-header"><a href="/s2024/modules/pwas/week2/2.1/#webstorage-localstorage-and-sessionstorage" class="sidebar-link">WebStorage (LocalStorage and SessionStorage)</a></li><li class="sidebar-sub-header"><a href="/s2024/modules/pwas/week2/2.1/#single-source-of-truth" class="sidebar-link">Single Source of Truth</a></li><li class="sidebar-sub-header"><a href="/s2024/modules/pwas/week2/2.1/#caches" class="sidebar-link">Caches</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/s2024/modules/pwas/week2/2.1/#cache-control-header" class="sidebar-link">Cache-Control Header</a></li></ul></li><li class="sidebar-sub-header"><a href="/s2024/modules/pwas/week2/2.1/#chrome-dev-tools" class="sidebar-link">Chrome Dev Tools</a></li><li class="sidebar-sub-header"><a href="/s2024/modules/pwas/week2/2.1/#caching-proxy-servers-and-cdn" class="sidebar-link">Caching, Proxy Servers, and CDN</a></li><li class="sidebar-sub-header"><a href="/s2024/modules/pwas/week2/2.1/#serializable" class="sidebar-link">Serializable</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/s2024/modules/pwas/week2/2.1/#structuredclone" class="sidebar-link">StructuredClone</a></li><li class="sidebar-sub-header"><a href="/s2024/modules/pwas/week2/2.1/#passing-functions" class="sidebar-link">Passing Functions</a></li></ul></li><li class="sidebar-sub-header"><a href="/s2024/modules/pwas/week2/2.1/#todo-this-week" class="sidebar-link">ToDo This Week</a></li></ul></li><li><a href="/s2024/modules/pwas/week2/2.2/" class="sidebar-link">2.2: Cache, Files &amp; Responses</a></li><li><a href="/s2024/modules/pwas/week3/3.1/" class="sidebar-link">3.1: Storage &amp; Data Manipulation</a></li><li><a href="/s2024/modules/pwas/week3/3.2/" class="sidebar-link">3.2: Intro to Workers</a></li><li><a href="/s2024/modules/pwas/week4/4.1/" class="sidebar-link">4.1: Service Workers</a></li><li><a href="/s2024/modules/pwas/week4/4.2/" class="sidebar-link">4.2: Messaging &amp; Screen APIs</a></li><li><a href="/s2024/modules/pwas/week5/5.1/" class="sidebar-link">5.1: Intro to PWA</a></li><li><a href="/s2024/modules/pwas/week5/5.2/" class="sidebar-link">5.2: Audits, Offline Status, &amp; Service Worker Methods</a></li><li><a href="/s2024/modules/pwas/week6/6.1/" class="sidebar-link">6.1: PWA Concept Review</a></li><li><a href="/s2024/modules/pwas/week6/6.2/" class="sidebar-link">6.2: Web App Hosting</a></li><li><a href="/s2024/modules/pwas/week7/7.1/" class="sidebar-link">7.1: PWA Project</a></li><li><a href="/s2024/modules/pwas/week7/7.2/" class="sidebar-link">7.2: PWA Project</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>React</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><header><div class="section-title red">
    PWA
  </div> <h1>2.1 Web Storage, Cookies, &amp; Cache</h1> <div class="underdev no">Module Still Under Development</div></header> <h2 id="client-side-storage"><a href="#client-side-storage" class="header-anchor">#</a> Client-Side Storage</h2> <p>There are a number of ways that we can store information in the browser (on the client-side). This week we will examine those options.</p> <p>First we need to remember why we store data on the client-side instead of the server-side.</p> <table><thead><tr><th style="text-align:left;">Client-Side Data</th> <th style="text-align:left;">Server-Side Data</th></tr></thead> <tbody><tr><td style="text-align:left;"></td> <td style="text-align:left;"></td></tr> <tr><td style="text-align:left;">Available only from one device</td> <td style="text-align:left;">Available to all users potentially</td></tr> <tr><td style="text-align:left;">Tied to one domain</td> <td style="text-align:left;">Can be used across domains through an API</td></tr> <tr><td style="text-align:left;">Can be deleted by the user easily. User controls their own data.</td> <td style="text-align:left;">Requires controlled access to delete</td></tr> <tr><td style="text-align:left;">No guarantee that the information is kept. The browser is allowed to delete it.</td> <td style="text-align:left;">Server-side databases designed to permanently and redundantly store information.</td></tr> <tr><td style="text-align:left;">Not available directly by the server</td> <td style="text-align:left;">Controlled by the domain owner</td></tr></tbody></table> <p>All the different types of client-side storage can be seen in Chrome via the Developer Tools <code>Application</code> tab.</p> <h2 id="cookies"><a href="#cookies" class="header-anchor">#</a> Cookies</h2> <p>Cookies were the first form of storage that was available in the browser. They are just a single string that is saved in the browser, in a storage area that is tied to a specific domain. Originally
cookie strings were only allowed to be 255 characters long. Now the string length is over 2000 characters, which is a long string but still fairly limited.</p> <div class="custom-block danger"><p class="custom-block-title">Cookie Security</p> <p>Cookies from one domain are NOT allowed to be read by code that came from another domain.</p></div> <p>Each browser has its own limitations on storage of cookie data. There is a limit for the total storage of cookies as well as a limit per domain.</p> <p>The cookie strings are made up of name value pairs, just like values in the query string of a URL. Here is an example of what the data part of a cookie could look like.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> cookieData <span class="token operator">=</span> <span class="token string">'name=Steve;'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>In addition to the data part of the cookie string, there are settings that control different limits on the cookie, such as the max age or expiry date for the cookie. Notice the semi-colon at the end
of the data portion of the cookie string. AFter the semi-colon we would add the other settings. Each of the settings are separated by a semi-colon.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> cookieSettings <span class="token operator">=</span> <span class="token string">'Path=/;Domain=127.0.0.1;Max-Age=30000;Secure;SameSite;HttpOnly;'</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> cookie <span class="token operator">=</span> cookieData <span class="token operator">+</span> cookieSettings<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>We would combine these two parts together to create a whole cookie string. Alternatively you could just put it all in one string to begin with.</p> <div title="Understanding Browser Cookies" class="video-player"><iframe width="560" height="315" src="https://www.youtube.com/embed/j0PpT96EFeg" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; fullscreen" allowfullscreen="allowfullscreen"></iframe></div> <h3 id="cookie-settings"><a href="#cookie-settings" class="header-anchor">#</a> Cookie Settings</h3> <p><strong>Path</strong></p> <p>By default, cookies apply to the root folder of your website. However we can add to this path value to restrict the cookies to a smaller part of our website.</p> <p><strong>Domain</strong></p> <p>By default, the domain value will be the domain of the HTML file. However, we can restrict it further to a specific subdomain if we want.</p> <p><strong>Max-Age</strong></p> <p>The max-age part of the cookie String will be the number of seconds that the cookie is to be considered valid.</p> <p><strong>Expires</strong></p> <p>As an alternative to the <code>Expires</code> setting you can provide an expiration date for the cookie. This will be compared to the time and date in the browser, not any server time or date.</p> <p><strong>Secure</strong></p> <p>If the secure value exists it means the cookie can only be accessed or set over <code>https</code>.</p> <p><strong>HttpOnly</strong></p> <p>The <code>HttpOnly</code> setting means that the setting is only used during HTTP requests to the server. The JavaScript cookie API does not have access to the value when reading a cookie.</p> <p><strong>SameSite</strong></p> <p>With the <code>SameSite</code> value set the cookie can be restricted to only to be sent with requests for files that are going to the same domain as the original HTML file.</p> <p>Cookies on the client side can only be read by pages that come from the same domain as the cookie.</p> <p>However, the cookie string can be sent from the browser as one of the headers in any request to any domain. To prevent this you should add <code>SameSite;</code> to your settings.</p> <p><code>SameSite</code> can be set to the possible values <code>Lax</code>, <code>None</code> or <code>Strict</code>. With the value <code>Strict</code> the cookies will only be sent with requests to the matching domain. <code>Lax</code> is similar but the cookies are
only sent when the user is navigating to the domain where the cookie originated. The cookie would not be sent with an API request sent to the cookie's domain. <code>None</code> means that cookies will be sent
with all requests except that the <code>Secure</code> setting must have also been set.</p> <h3 id="cookie-methods"><a href="#cookie-methods" class="header-anchor">#</a> Cookie Methods</h3> <p>If you want to set or update a cookie from the browser you only have to overwrite the whole cookie string using the <code>document.cookie</code> property.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>document<span class="token punctuation">.</span>cookie <span class="token operator">=</span> <span class="token string">'user=123&amp;name=Steve;path=/;domain=localhost;Expires=Fri, 14 Jan 2022 07:28:00 GMT;'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>That one line of code will replace the previously saved cookie with those settings.</p> <p>Every change to the settings means that you are setting a separate cookie. This snippet is actually trying to set three cookies in the browser. However, since the first and last cookies have the same
path, and domain, and default values for the other settings, the third cookie actually overwrites the first one.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>document<span class="token punctuation">.</span>cookie <span class="token operator">=</span> <span class="token string">'user=123;Path=/;Domain=127.0.0.1;Max-Age=55000;'</span><span class="token punctuation">;</span>
document<span class="token punctuation">.</span>cookie <span class="token operator">=</span> <span class="token string">'name=Tony;Path=/;Domain=127.0.0.1;Expires=Fri, 14 Jan 2022 07:28:00 GMT;'</span><span class="token punctuation">;</span>
document<span class="token punctuation">.</span>cookie <span class="token operator">=</span> <span class="token string">'user=456;Path=/;Domain=127.0.0.1;Expires=Fri, 14 Jan 2022 07:28:00 GMT;'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>When you want to read the value from the cookies you would put the <code>document.cookie</code> value into a variable, split the string on the <code>;</code> semi-colons plus a space, and then take each portion.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> cookie <span class="token operator">=</span> document<span class="token punctuation">.</span>cookie<span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>cookie<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// `user=456; name=Tony` or  `name=Tony; user=456`</span>
<span class="token keyword">let</span> cookies <span class="token operator">=</span> cookie<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'; '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//cookies is an array of name=value pairs</span>
cookies<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">c</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//use split and array destructuring</span>
  <span class="token keyword">let</span> <span class="token punctuation">[</span>name<span class="token punctuation">,</span> value<span class="token punctuation">]</span> <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'='</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">The </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> cookie has a value of </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>All the cookies that have been set for the current <code>Path</code> and <code>Domain</code> will be gathered into a single string that we split apart and then split each of the parts on their <code>=</code> equal signs.</p> <h2 id="passing-data-between-pages"><a href="#passing-data-between-pages" class="header-anchor">#</a> Passing Data between Pages</h2> <p>When building a multi-page website there will often be times when you want to pass data, as key-value pairs, between your pages.</p> <p>Each HTML page will load, and then load the script for the page. So, we need to be able to package the data in a way that can then be sent from the first page along with the HTTP Request and then read
from the HTTP Response. The approaches from easiest to hardest are:</p> <ol><li>In the URL querystring.</li> <li>In a cookie.</li> <li>Written with some type of storage API that can be read on the second page (localStorage, sessionStorage, IndexedDB, and CacheAPI).</li></ol> <h3 id="in-the-querystring"><a href="#in-the-querystring" class="header-anchor">#</a> In the QueryString</h3> <p>To pass data through the querystring, you can hard code a value in an anchor tag.</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/pagetwo.html?name=sam&amp;brother=dean<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Go to Page Two<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Then in the script on the second page you can extract the value from the querystring.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//the current page url</span>
<span class="token keyword">let</span> params <span class="token operator">=</span> url<span class="token punctuation">.</span>searchParams<span class="token punctuation">;</span> <span class="token comment">// a URLSearchParams object with all the queryString parameters</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>params<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// sam</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'brother'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// dean</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><hr> <p>In the first page, if you want to dynamically add elements to a querystring in a URL, you can use a similar script to the second page.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span><span class="token string">'http://localhost:/pagetwo.html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> params <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URLSearchParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// or url.searchParams</span>
params<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'sam'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
params<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'brother'</span><span class="token punctuation">,</span> <span class="token string">'dean'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
url<span class="token punctuation">.</span>search <span class="token operator">=</span> params<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
location<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>url<span class="token punctuation">.</span>href<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//navigate to the new page with the querystring</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>Another way this can be accomplished is by submitting a form. An HTML <code>&lt;form&gt;</code> element has a <code>method</code> attribute with a default value of <code>GET</code>, and an <code>action</code> attribute which is the URL to use as the
HTTP Request URL. When a form is submitted an HTTP GET Request is sent to the server for the URL defined in the action. The elements from the form (input, select, textarea, button) will have their
name and value pairs added to the querystring if the method is the default <code>GET</code>.</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>pagetwo.html<span class="token punctuation">&quot;</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>GET<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sam<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>brother<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dean<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>send<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>SEND DATA TO PAGE TWO<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><blockquote><p>NOTE: the form elements must have <code>name</code> attributes, not just <code>id</code>s.</p></blockquote> <p>When the user clicks the button, the form is submitted. This means an HTTP request is made for the url in the action attribute using the method defined in the method attribute.</p> <h3 id="in-a-cookie"><a href="#in-a-cookie" class="header-anchor">#</a> In a Cookie</h3> <p>A cookie is really just a header in an HTTP Request or Response.</p> <p>An HTTP <strong>Request</strong> can have a header called <code>cookie</code>, whose value will be the cookies currently saved in the browser.</p> <p>An HTTP <strong>Response</strong> can have a header called <code>set-cookie</code>, whose value will be a cookie that needs to be saved by the browser.</p> <p>If you use JavaScript to set a cookie in the browser:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>document<span class="token punctuation">.</span>cookie <span class="token operator">=</span> <span class="token string">'name=sam;maxAge=3600;secure=false;path=/'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>then it will be part of the next HTTP Request made to the server. The next page to load will be able to access the <code>document.cookie</code> value too.</p> <p>Cookies that have the <code>httpOnly=true</code> flag setting will not be cookies that can be set, read, or modified in JavaScript. They will automatically be sent with every navigation request and response, but
not with fetch calls. They can only be set in a Response object that is coming from the server.</p> <h3 id="storage-apis"><a href="#storage-apis" class="header-anchor">#</a> Storage APIs</h3> <p>With localStorage and sessionStorage you use a key to label the data and then you can store any value that can be stringified with the <code>JSON.stringify()</code> method.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//on page one</span>
<span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'sam'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">brother</span><span class="token operator">:</span> <span class="token string">'dean'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'mydata'</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//on page two</span>
<span class="token keyword">let</span> json <span class="token operator">=</span> localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">'mydata'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> data <span class="token operator">=</span> json <span class="token operator">?</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>With <code>IndexedDB</code> you can also save information to be read later on from another page. The premise is the same as working with localStorage or sessionStorage, it just requires more code.</p> <p>With the Cache API you can also save data to be read later. However, you need to turn the data into a file to be opened and read later.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//on page one</span>
<span class="token keyword">let</span> dataTxt <span class="token operator">=</span> <span class="token string">'name=sam&amp;brother=dean'</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> textFile <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token punctuation">[</span>dataTxt<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'data.txt'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'text/plain'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> dataObj <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'sam'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">brother</span><span class="token operator">:</span> <span class="token string">'dean'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> json <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>dataObj<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> jsonFile <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token punctuation">[</span>json<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'data.json'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'application/json'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> cache <span class="token operator">=</span> caches<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'myfiles'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> textRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Request</span><span class="token punctuation">(</span><span class="token string">'data.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>textRequest<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span>textFile<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string-property property">'content-type'</span><span class="token operator">:</span> <span class="token string">'text/plain'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> jsonRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Request</span><span class="token punctuation">(</span><span class="token string">'data.json'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>jsonRequest<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span>jsonFile<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string-property property">'content-type'</span><span class="token operator">:</span> <span class="token string">'application/json'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>The above code will create a text file and a json file and save them in the cache for the current origin.</p> <p>To retrieve the data we use the <code>cache.match()</code> method to extract the Response objects from the cache. Then you can do exactly what you would do with a fetch response. Call the <code>.json()</code> or <code>.text()</code>
method to read the contents from the files.</p> <h2 id="webstorage-localstorage-and-sessionstorage"><a href="#webstorage-localstorage-and-sessionstorage" class="header-anchor">#</a> WebStorage (LocalStorage and SessionStorage)</h2> <p>The Web Storage API has two parts - <code>localStorage</code> and <code>sessionStorage</code>. They have the same methods and properties and work the exact same way. The only difference is that the <code>sessionStorage</code> values
are automatically deleted at the end of the user's session. This means when they close the browser or the tab that contained the current domain as part of the tab's current history.</p> <p>From this point on I will be referring to <code>localStorage</code> only but everything also applies to <code>sessionStorage</code>. Both are a global property accessible from the <code>window</code> object in the browser. They do
not exist in NodeJS.</p> <p>All the data stored in <code>localStorage</code> gets stored as a <code>JSON</code> string.</p> <p>This means that only information that is capable of being a JSON string can be saved in <code>localStorage</code>. No functions, no DOM elements, can be stored in <code>localStorage</code>.</p> <p>We will need to use the built-in <code>JSON</code> methods to convert the data back and forth between a string and an object.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> myObject <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">123</span><span class="token punctuation">,</span>
  <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'The Big Bang Theory'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">seasons</span><span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">,</span>
  <span class="token literal-property property">firstSeasonYear</span><span class="token operator">:</span> <span class="token number">2007</span><span class="token punctuation">,</span>
  <span class="token literal-property property">stillPlaying</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">//convert the object into a JSON string.</span>
<span class="token keyword">let</span> stringData <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>myObject<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//convert the string back into an object</span>
<span class="token keyword">let</span> objectCopy <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>stringData<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>If you ever need to make a deep copy of an object, this is one way of doing it.</p> <p>If the data that you want to convert to JSON is already a just a string, then you should not use the <code>JSON.stringify()</code> method as it will add an extra set of quotation marks.</p> <div class="custom-block tip"><p class="custom-block-title">Remember</p> <p>It is important to remember that we have no way of editing the strings inside of <code>localStorage</code>. All we can ever do is replace the string with a new one.</p></div> <p>Every time we read or write a value from <code>localStorage</code> we need to use a unique key. The key will be the unique name for that chunk of data. All keys need to be String values. An example key that you
could use for an assignment would be <code>abcd0001-com.example-userscores</code>. It has a username, a domain name, and a descriptive term for what the data is.</p> <div title="LocalStorage and SessionStorage" class="video-player"><iframe width="560" height="315" src="https://www.youtube.com/embed/hOCYNdgsUfs" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; fullscreen" allowfullscreen="allowfullscreen"></iframe></div> <div title="Storage Events" class="video-player"><iframe width="560" height="315" src="https://www.youtube.com/embed/WxnjkZRt3_Y" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; fullscreen" allowfullscreen="allowfullscreen"></iframe></div> <div class="custom-block warning"><p class="custom-block-title">Unique Key Names</p> <p>Remember to keep your <code>localStorage</code> key names unique. You don't want to overwrite other data being saved in localStorage or have your data overwritten. Use a name that includes a reference to the
domain, the web application, and even your own development team, plus the purpose of the data.</p></div> <h2 id="single-source-of-truth"><a href="#single-source-of-truth" class="header-anchor">#</a> Single Source of Truth</h2> <p>When working with data sources like localStorage and cookies, which are not directly accessible as a variable, we need to create what is known as a <code>single source of truth</code>.</p> <p>It is possible to have multiple functions in multiple scripts that are accessing the values in your cookies or localStorage within the context of the same page load. If one script updates
<code>localStorage</code> then we might not know that the change was made in another function that is sharing that data.</p> <p>To avoid problems caused by this the best approach is to create your own <strong>globally accessible</strong> variable that will hold the data.</p> <p>The <code>cookie</code> and <code>localStorage</code> values are the <strong>CACHED</strong> copy of the data. They only exist to give us context when the app is loaded the next time. We do NOT work directly from these sources. We do
not keep updating and re-reading these data sources. Only read the value once when the page loads. Work with a local copy of the data from a variable. Update your variable as needed. Overwrite the
cookie or localStorage after you update your variable.</p> <p>When the page first loads, we read the value from the <code>cookie</code> and/or <code>localStorage</code> and put it into the global variable.</p> <p>Any function that needs to access or change the information will make the change to that global variable.</p> <p>Each time the global variable is altered you can call on the <code>document.cookie</code> property or <code>localStorage.setItem</code> method to update the <code>cached</code> value. Remember we are only updating the cache for the
next time the app loads.</p> <p>The only time we ever read from the storage is when the app first loads - using the <code>DOMContentLoaded</code> event as our trigger to fetch the cached data.</p> <h2 id="caches"><a href="#caches" class="header-anchor">#</a> Caches</h2> <p>The other place where we can store data is in the local <code>Cache API</code>. To be clear, this is the cache that we can see through the Application tab in the Chrome Web Development tools.</p> <p>The <code>Cache API</code> is not to be confused with the <code>Cache-Control Header</code> and the browser cache which is part of the HTTP Response specification. The <code>Cache API</code> is fully controlled by the developer. The
developer gets to decide which files are saved and for how long.</p> <p>The browser cache is the cache where the browser saves previously downloaded images, css, js, and html files. The browser does this to save time and bandwidth. The browser also has its own cache, not
the one controlled by the <code>Cache API</code>. It will save copies of the files in each website. Each file has an expiry date when a new version will need to be downloaded to replace the cached version.</p> <p>The <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Cache-Control" target="_blank" rel="noopener noreferrer">Cache-Control Header<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> is a header that is sent from the server or proxy-server to the client along with a requested file.
It tells the browser how to handle the caching of the requested file and how long it should be considered valid before requesting a new copy of the file.</p> <p>If you need to review what headers are and how they work, <a href="https://mad9014.github.io/W2024/modules/browser-js/week10/ajax/#header-objects" target="_blank" rel="noopener noreferrer">review the notes in MAD9014<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <h3 id="cache-control-header"><a href="#cache-control-header" class="header-anchor">#</a> Cache-Control Header</h3> <p>The name of the header is <code>cache-control</code> and it can hold a variety of directives. Here are a few examples of the header showing some of the directives.</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Cache-Control: max-age=604800
Cache-Control: no-cache
Cache-Control: max-age=604800, must-revalidate
Cache-Control: no-store
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div> <p>Here is a video about generating custom <code>Response</code> Objects that contain <code>File</code> Objects and how to save them with the <code>Cache API</code>.</p> <div title="Custom Responses, Files, and the Cache API" class="video-player"><iframe width="560" height="315" src="https://www.youtube.com/embed/HlI4-hVmGT4" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; fullscreen" allowfullscreen="allowfullscreen"></iframe></div> <h2 id="chrome-dev-tools"><a href="#chrome-dev-tools" class="header-anchor">#</a> Chrome Dev Tools</h2> <p>Here is a short video that outlines all the Chrome Dev Tools that you could use to work with all the data storage and file apis.</p> <div title="chrome dev tools - Data and File Storage" class="video-player"><iframe width="560" height="315" src="https://www.youtube.com/embed/0JY4oQD66L4" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; fullscreen" allowfullscreen="allowfullscreen"></iframe></div> <h2 id="caching-proxy-servers-and-cdn"><a href="#caching-proxy-servers-and-cdn" class="header-anchor">#</a> Caching, Proxy Servers, and CDN</h2> <p>The primary purpose of caching a file is to save time later. If you already have a file in your cache then you won't have to download it again. <code>Cache-control</code> headers control how a browser handles
files that it receives.</p> <p>The Cache API allows another level of caching which is controlled through JavaScript.</p> <p>When you request a file from a Server, that server could be located anywhere in the world. There will be a delay between when a file is requested and returned to the browser. This delay is generally
be referred to as <code>latency</code>.</p> <p>There are also <code>CDN</code>s - Content Delivery Networks that can be used to reduce latency. These are made up of proxy servers, which are located all over the world, so that they will be closer to anyone
requesting content from a website that is associated with the CDN (pays the CDN). The closer proxy server will have lower latency than the distant servers. Each proxy server can save cached copies of
request files.</p> <p>The length of time that files are cached for will vary depending on the file type, the original source of the file, and the popularity of the files.</p> <p>An example of a CDN that you will probably use at some point is <a href="https://www.jsdelivr.com/" target="_blank" rel="noopener noreferrer">https://www.jsdelivr.com/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. This is a CDN that can be used for free hosting of public JS libraries.</p> <p>In the coming weeks we will be talking about Service Workers. These Service Workers will be able to act like a Proxy Server except it will be on each users' own computer.</p> <h2 id="serializable"><a href="#serializable" class="header-anchor">#</a> Serializable</h2> <p>In JavaScript, functions are first class objects. That means you can store a reference to a function inside a variable, and you can pass a function reference as a parameter to a function or as a
return value from a function.</p> <p>However, you cannot store a function inside of a JSON string. There is no way to send a function to a server via an HTTP Request or from a server via an HTTP Response.</p> <p>Functions are not <code>serializable</code>. This means that they cannot be converted into a JSON representation. HTML Elements are another type of Object that is also not <code>serializable</code>.</p> <h3 id="structuredclone"><a href="#structuredclone" class="header-anchor">#</a> StructuredClone</h3> <p>If you want to make a copy of a JavaScript object and avoid having to recursively copy the nested objects, then you can use the new <code>structuredClone()</code> method.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">prop1</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">prop2</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">123</span><span class="token punctuation">,</span> <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token number">234</span><span class="token punctuation">,</span> <span class="token literal-property property">c</span><span class="token operator">:</span> <span class="token number">456</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> copy <span class="token operator">=</span> <span class="token function">structuredClone</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//make a copy of the nested array and object inside the new copy object</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div title="Intro to JS StructuredClone" class="video-player"><iframe width="560" height="315" src="https://www.youtube.com/embed/M3JO4qxTLH0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; fullscreen" allowfullscreen="allowfullscreen"></iframe></div> <h3 id="passing-functions"><a href="#passing-functions" class="header-anchor">#</a> Passing Functions</h3> <p>So, if you can't pass a function through an HTTP Request or Response it also means that you can't pass a function as a <code>message</code> between a page and a service worker or between tabs. Later on we will
be talking about Client API messaging, Broadcast messaging, and Channel messaging. We will need a solution to passing a function.</p> <p>What we <strong>can</strong> pass is a <code>String</code>. We can pass the name of a function as a String.</p> <p>When you declare a function in a simple non-module script, the name of the function is actually added to the window object. You can check if the property is there.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">sam</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'this is sam.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">dean</span><span class="token punctuation">(</span><span class="token parameter">nameOfFunc</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>nameOfFunc <span class="token keyword">in</span> window <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> window<span class="token punctuation">[</span>nameOfFunc<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//property exists in the window object</span>
    <span class="token comment">//and the property is a function</span>
    <span class="token comment">//so you can call the function</span>
    <span class="token function">nameOfFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">function </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>nameOfFunc<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> does not exist.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">dean</span><span class="token punctuation">(</span><span class="token string">'sam'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//this is sam</span>
<span class="token function">dean</span><span class="token punctuation">(</span><span class="token string">'crowley'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//function crowley does not exist</span>
<span class="token function">dean</span><span class="token punctuation">(</span><span class="token string">'rowena'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//function rowena does not exist</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>The above solution works if you are not dealing with a module. When you load a script with <code>&lt;script type=&quot;module&quot;&gt;</code> it means that a module scope is created for the file and the functions are NOT added
to the <code>window</code> object. If this is the case, then you can take the name of the function and wrap it in an <code>eval()</code> call. This will try to convert the string into an object with a matching name - the
function.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//script loaded as module</span>
<span class="token keyword">function</span> <span class="token function">sam</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'This is sam.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">dean</span><span class="token punctuation">(</span><span class="token parameter">nameOfFunction</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token function">eval</span><span class="token punctuation">(</span>nameOfFunction<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//it is a function so call it</span>
    <span class="token function">eval</span><span class="token punctuation">(</span>nameOfFunction<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>nameOfFuntion<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> is not a function.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">dean</span><span class="token punctuation">(</span><span class="token string">'sam'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// This is sam.</span>
<span class="token function">dean</span><span class="token punctuation">(</span><span class="token string">'charlie'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// charlie is not a function.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>One other way that this can be accomplished with modules is if you place all the functions that you want to call, based on their names, into their own module and you import that file with a namespace.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// list.js</span>
<span class="token comment">//my functions to call based on name</span>
<span class="token keyword">function</span> <span class="token function">sam</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'This is sam.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">crowley</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'This is crowley.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span> sam<span class="token punctuation">,</span> crowley <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>Above is the file that we will import and search for function names.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> <span class="token constant">LIST</span> <span class="token keyword">from</span> <span class="token string">'./list.js'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">dean</span><span class="token punctuation">(</span><span class="token parameter">nameOfFunction</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>nameOfFunction <span class="token keyword">in</span> <span class="token constant">LIST</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> <span class="token constant">LIST</span><span class="token punctuation">[</span>nameOfFunction<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//it is something imported in LIST</span>
    <span class="token comment">//it is a function</span>
    <span class="token comment">//call the function</span>
    <span class="token constant">LIST</span><span class="token punctuation">[</span>nameOfFunction<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Not a function'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">dean</span><span class="token punctuation">(</span><span class="token string">'sam'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// works</span>
<span class="token function">dean</span><span class="token punctuation">(</span><span class="token string">'crowley'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// works</span>
<span class="token function">dean</span><span class="token punctuation">(</span><span class="token string">'rowena'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// fails</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h2 id="todo-this-week"><a href="#todo-this-week" class="header-anchor">#</a> ToDo This Week</h2> <div class="custom-block danger"><p class="custom-block-title">To Do this week</p> <ul><li>read all the content for modules 2.1 and 2.2</li> <li>Complete and submit <a href="/s2024/modules/hybrids/exercises.html">Hybrid exercise 1 - JS Class Quiz</a>.</li> <li>Review the description for the <a href="/s2024/assignments/assign/">Cache API Assignment</a>.</li></ul></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">5/1/2024, 1:25:04 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/s2024/modules/pwas/week1/1.2/" class="prev">
        1.2: Git &amp; Pull Requests
      </a></span> <span class="next"><a href="/s2024/modules/pwas/week2/2.2/">
        2.2: Cache, Files &amp; Responses
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/s2024/assets/js/app.800de6cb.js" defer></script><script src="/s2024/assets/js/2.65264708.js" defer></script><script src="/s2024/assets/js/33.9514a6a6.js" defer></script><script src="/s2024/assets/js/9.005e1e8c.js" defer></script><script src="/s2024/assets/js/11.87711128.js" defer></script>
  </body>
</html>
